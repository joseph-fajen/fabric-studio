<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabric Studio - Text Analysis Made Simple</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Coral Reef Laboratory Color Palette */
            --coral-primary: rgba(255, 127, 80, 0.9);
            --coral-secondary: rgba(255, 160, 122, 0.7);
            --sea-green: rgba(32, 178, 170, 0.8);
            --sea-green-light: rgba(32, 178, 170, 0.4);
            --tropical-blue: rgba(70, 130, 180, 0.9);
            --tropical-blue-light: rgba(70, 130, 180, 0.3);
            --deep-teal: rgba(0, 139, 139, 0.8);
            --aqua-glow: rgba(0, 255, 255, 0.3);
            --bioluminescent: rgba(173, 255, 47, 0.6);
            --sandy-beige: rgba(245, 222, 179, 0.2);
            
            /* Living Glass Backgrounds */
            --reef-bg-primary: rgba(255, 255, 255, 0.08);
            --reef-bg-secondary: rgba(255, 255, 255, 0.12);
            --reef-bg-tertiary: rgba(255, 255, 255, 0.16);
            --reef-bg-elevated: rgba(255, 255, 255, 0.2);
            --reef-bg-modal: rgba(255, 255, 255, 0.25);
            
            /* Organic Borders */
            --reef-border: rgba(255, 255, 255, 0.25);
            --reef-border-subtle: rgba(255, 255, 255, 0.15);
            --reef-border-strong: rgba(255, 255, 255, 0.35);
            --reef-border-glow: rgba(32, 178, 170, 0.4);
            
            /* Bioluminescent Text */
            --text-reef-primary: rgba(255, 255, 255, 0.96);
            --text-reef-secondary: rgba(255, 255, 255, 0.82);
            --text-reef-tertiary: rgba(255, 255, 255, 0.68);
            --text-reef-muted: rgba(255, 255, 255, 0.54);
            --text-reef-accent: rgba(32, 178, 170, 0.95);
            
            /* Organic Shadows */
            --reef-shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.15);
            --reef-shadow-medium: 0 8px 40px rgba(0, 0, 0, 0.2);
            --reef-shadow-deep: 0 16px 80px rgba(0, 0, 0, 0.3);
            --reef-shadow-bioluminescent: 0 0 40px rgba(32, 178, 170, 0.2);
            --reef-shadow-coral: 0 0 30px rgba(255, 127, 80, 0.15);
            
            /* Flowing Blur Effects */
            --reef-blur-gentle: blur(8px);
            --reef-blur-medium: blur(16px);
            --reef-blur-deep: blur(24px);
            --reef-blur-mystical: blur(40px);
            
            /* Organic Dimensions */
            --border-radius-coral: 20px;
            --border-radius-anemone: 32px;
            --border-radius-pearl: 16px;
            --border-radius-organic: 50px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: radial-gradient(ellipse at top, 
                #1a3b5c 0%, 
                #2c5f7e 20%, 
                #1e4a6b 40%, 
                #0f2a44 70%, 
                #081c2e 100%);
            background-attachment: fixed;
            color: var(--text-reef-primary);
            line-height: 1.6;
            font-size: 16px;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Coral Reef Ambient Environment */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 15% 25%, var(--coral-primary) 0%, transparent 45%),
                radial-gradient(circle at 85% 75%, var(--sea-green) 0%, transparent 40%),
                radial-gradient(circle at 45% 85%, var(--tropical-blue) 0%, transparent 35%),
                radial-gradient(circle at 75% 15%, var(--bioluminescent) 0%, transparent 30%);
            opacity: 0.3;
            pointer-events: none;
            z-index: -2;
        }

        @keyframes coralBreathing {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.02); }
        }

        /* Floating Bioluminescent Particles */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--bioluminescent) 1px, transparent 1px),
                radial-gradient(circle at 70% 60%, var(--aqua-glow) 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, var(--coral-secondary) 1px, transparent 1px),
                radial-gradient(circle at 90% 20%, var(--sea-green-light) 1px, transparent 1px);
            background-size: 120px 120px, 180px 180px, 240px 240px, 300px 300px;
            pointer-events: none;
            z-index: -1;
            opacity: 0.2;
        }

        @keyframes bioFlow {
            0%, 100% { 
                transform: translateX(0px) translateY(0px) rotate(0deg);
                opacity: 0.4;
            }
            25% { 
                transform: translateX(-15px) translateY(-8px) rotate(2deg);
                opacity: 0.6;
            }
            50% { 
                transform: translateX(8px) translateY(12px) rotate(-1deg);
                opacity: 0.5;
            }
            75% { 
                transform: translateX(12px) translateY(-5px) rotate(1deg);
                opacity: 0.7;
            }
        }

        /* Underwater Current Effect */
        .current-lines {
            display: none;
        }

        @keyframes currentFlow {
            0% { background-position: 0% 0%, 0% 0%; }
            100% { background-position: 200px 200px, -150px 150px; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 24px;
            position: relative;
            z-index: 1;
        }

        /* Organic Header with Coral Growth Pattern */
        .header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, var(--sea-green) 0%, var(--coral-primary) 30%, transparent 70%);
            border-radius: 60% 40% 70% 30%;
            filter: var(--reef-blur-medium);
            z-index: -1;
        }

        @keyframes coralGrowth {
            0%, 100% { 
                border-radius: 60% 40% 70% 30%;
                transform: translateX(-50%) scale(1) rotate(0deg);
            }
            50% { 
                border-radius: 40% 60% 30% 70%;
                transform: translateX(-50%) scale(1.1) rotate(5deg);
            }
        }

        .header h1 {
            font-size: 4.5rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 20px;
            background: linear-gradient(135deg, 
                var(--text-reef-primary) 0%, 
                var(--coral-primary) 25%,
                var(--sea-green) 50%, 
                var(--tropical-blue) 75%,
                var(--text-reef-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 50px var(--sea-green);
            position: relative;
        }

        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 50px var(--sea-green); }
            50% { text-shadow: 0 0 70px var(--coral-primary), 0 0 90px var(--sea-green); }
        }

        .header p {
            color: var(--text-reef-secondary);
            font-size: 1.3rem;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
            text-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
        }

        @keyframes subtleGlow {
            0%, 100% { color: var(--text-reef-secondary); }
            50% { color: var(--text-reef-accent); }
        }

        /* Living Coral Card */
        .coral-card {
            background: var(--reef-bg-secondary);
            backdrop-filter: var(--reef-blur-medium);
            -webkit-backdrop-filter: var(--reef-blur-medium);
            border: 2px solid var(--reef-border);
            border-radius: var(--border-radius-anemone);
            padding: 45px;
            margin-bottom: 40px;
            box-shadow: var(--reef-shadow-medium), var(--reef-shadow-bioluminescent);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .coral-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--coral-primary) 25%,
                var(--sea-green) 50%,
                var(--tropical-blue) 75%,
                transparent 100%);
            animation: reefShimmer 8s ease-in-out infinite;
        }

        @keyframes reefShimmer {
            0%, 100% { opacity: 0.6; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }

        .coral-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                transparent 50%, 
                rgba(32, 178, 170, 0.03) 100%);
            pointer-events: none;
            border-radius: var(--border-radius-anemone);
        }

        .coral-card:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: var(--reef-shadow-deep), var(--reef-shadow-bioluminescent), var(--reef-shadow-coral);
            border-color: var(--reef-border-glow);
            background: var(--reef-bg-tertiary);
        }

        /* Elevated Reef Structure */
        .coral-card-elevated {
            background: var(--reef-bg-elevated);
            backdrop-filter: var(--reef-blur-deep);
            -webkit-backdrop-filter: var(--reef-blur-deep);
            border: 2px solid var(--reef-border-strong);
            border-radius: var(--border-radius-organic);
            padding: 50px;
            box-shadow: var(--reef-shadow-deep), 
                        0 0 80px rgba(32, 178, 170, 0.2),
                        inset 0 2px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: organicPulse 12s ease-in-out infinite;
        }

        @keyframes organicPulse {
            0%, 100% { border-radius: var(--border-radius-organic); }
            50% { border-radius: 45px 25px 40px 30px; }
        }

        .coral-card-elevated::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, 
                rgba(255, 127, 80, 0.08) 0%, 
                transparent 40%),
                radial-gradient(circle at 70% 80%, 
                rgba(32, 178, 170, 0.06) 0%, 
                transparent 40%);
            pointer-events: none;
            animation: organicAmbient 18s ease-in-out infinite;
        }

        @keyframes organicAmbient {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Input Elements with Coral Texture */
        .input-group {
            margin-bottom: 35px;
            position: relative;
        }

        .reef-info-note {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 15px;
            padding: 20px;
            background: var(--reef-bg-secondary);
            border: 1px solid var(--reef-border-subtle);
            border-radius: 15px;
            backdrop-filter: blur(20px);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .info-icon {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .info-content strong {
            color: rgba(255, 255, 255, 0.95);
            font-weight: 600;
        }

        .info-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-content li {
            margin: 8px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .info-content p {
            margin-top: 12px;
            color: rgba(255, 255, 255, 0.85);
            font-style: italic;
        }

        .input-label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-reef-primary);
            margin-bottom: 15px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .url-input {
            width: 100%;
            padding: 22px 28px;
            font-size: 1.15rem;
            background: var(--reef-bg-primary);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border);
            border-radius: var(--border-radius-coral);
            color: var(--text-reef-primary);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-family: inherit;
            box-shadow: inset 0 3px 12px rgba(0, 0, 0, 0.15);
        }

        .url-input::placeholder {
            color: var(--text-reef-muted);
        }

        .url-input:focus {
            outline: none;
            border-color: var(--reef-border-glow);
            background: var(--reef-bg-secondary);
            box-shadow: 0 0 0 4px rgba(32, 178, 170, 0.2),
                        inset 0 3px 12px rgba(0, 0, 0, 0.15),
                        0 0 40px rgba(32, 178, 170, 0.15);
            transform: translateY(-2px);
        }

        /* Bioluminescent Button */
        .bio-button {
            background: linear-gradient(135deg, 
                var(--sea-green) 0%, 
                var(--tropical-blue) 50%,
                var(--coral-primary) 100%);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid rgba(32, 178, 170, 0.6);
            border-radius: var(--border-radius-coral);
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            padding: 22px 45px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            box-shadow: var(--reef-shadow-soft), 
                        0 0 30px rgba(32, 178, 170, 0.3);
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .bio-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            transition: left 0.6s ease;
        }

        .bio-button:hover::before {
            left: 100%;
        }

        /* Universal Content Input Interface Styles */
        .input-method-selector {
            margin-bottom: 32px;
        }

        .method-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .method-tab {
            flex: 1;
            padding: 12px 20px;
            background: var(--reef-bg-primary);
            border: 2px solid var(--reef-border-subtle);
            border-radius: var(--border-radius-pearl);
            color: var(--text-reef-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .method-tab:hover {
            background: var(--reef-bg-secondary);
            border-color: var(--reef-border);
            color: var(--text-reef-primary);
        }

        .method-tab.active {
            background: var(--sea-green);
            border-color: var(--sea-green);
            color: white;
            box-shadow: 0 0 20px rgba(32, 178, 170, 0.3);
        }

        .input-method {
            display: none;
        }

        .input-method.active {
            display: block;
        }

        /* Drag and Drop Zone */
        .dropzone {
            border: 3px dashed var(--reef-border);
            border-radius: var(--border-radius-coral);
            padding: 40px 20px;
            text-align: center;
            background: var(--reef-bg-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            min-height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dropzone:hover,
        .dropzone.drag-over {
            border-color: var(--sea-green);
            background: var(--reef-bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(32, 178, 170, 0.2);
        }

        .dropzone-content {
            pointer-events: none;
        }

        .dropzone-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.7;
        }

        .dropzone-text strong {
            color: var(--text-reef-primary);
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }

        .dropzone-text p {
            color: var(--text-reef-secondary);
            margin-bottom: 8px;
        }

        .file-browse-link {
            color: var(--sea-green);
            text-decoration: underline;
            cursor: pointer;
        }

        .dropzone-text small {
            color: var(--text-reef-muted);
            font-size: 12px;
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 16px;
            padding: 16px;
            background: var(--reef-bg-secondary);
            border-radius: var(--border-radius-pearl);
            border: 1px solid var(--reef-border-subtle);
        }

        .file-info-name {
            color: var(--text-reef-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .file-info-details {
            color: var(--text-reef-secondary);
            font-size: 14px;
        }

        /* Transcript Textarea */
        .transcript-textarea {
            width: 100%;
            padding: 20px 24px;
            background: var(--reef-bg-primary);
            border: 2px solid var(--reef-border-subtle);
            border-radius: var(--border-radius-coral);
            color: var(--text-reef-primary);
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 200px;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .transcript-textarea::placeholder {
            color: var(--text-reef-muted);
        }

        .transcript-textarea:focus {
            outline: none;
            border-color: var(--reef-border-glow);
            background: var(--reef-bg-secondary);
            box-shadow: 0 0 0 4px rgba(32, 178, 170, 0.2),
                        inset 0 3px 12px rgba(0, 0, 0, 0.15);
        }

        /* Text Statistics */
        .text-stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 14px;
            color: var(--text-reef-secondary);
        }

        .text-stats span {
            padding: 6px 12px;
            background: var(--reef-bg-primary);
            border-radius: var(--border-radius-pearl);
            border: 1px solid var(--reef-border-subtle);
        }

        /* Content Preview */
        .content-preview {
            margin-top: 24px;
            padding: 20px;
            background: var(--reef-bg-secondary);
            border-radius: var(--border-radius-coral);
            border: 1px solid var(--reef-border);
        }

        .content-preview h4 {
            color: var(--text-reef-accent);
            margin-bottom: 12px;
            font-size: 16px;
        }

        .preview-text {
            background: var(--reef-bg-primary);
            padding: 16px;
            border-radius: var(--border-radius-pearl);
            border: 1px solid var(--reef-border-subtle);
            max-height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-reef-secondary);
            white-space: pre-wrap;
        }

        .preview-stats {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--text-reef-muted);
        }

        .preview-stats span {
            padding: 4px 8px;
            background: var(--reef-bg-primary);
            border-radius: 6px;
            border: 1px solid var(--reef-border-subtle);
        }

        /* Disabled state for process button */
        .bio-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .bio-button:disabled:hover {
            transform: none;
            box-shadow: var(--reef-shadow-soft), 
                        0 0 30px rgba(32, 178, 170, 0.3);
        }

        .bio-button-disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
        }

        /* Responsive design for new elements */
        @media (max-width: 768px) {
            .method-tabs {
                flex-direction: column;
            }

            .method-tab {
                flex: none;
            }

            .text-stats {
                flex-wrap: wrap;
                gap: 10px;
            }

            .preview-stats {
                flex-wrap: wrap;
                gap: 8px;
            }

            .dropzone {
                padding: 30px 15px;
                min-height: 140px;
            }

            .dropzone-icon {
                font-size: 36px;
            }

            .dropzone-text strong {
                font-size: 16px;
            }

            /* Resources section responsive */
            .resources-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
        }

        .bio-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--reef-shadow-medium), 
                        0 0 50px rgba(32, 178, 170, 0.5),
                        0 0 80px rgba(255, 127, 80, 0.3);
            border-color: rgba(32, 178, 170, 0.9);
        }

        .bio-button:active {
            transform: translateY(-1px) scale(1.01);
        }

        .bio-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            animation: disabledPulse 2s ease-in-out infinite;
        }

        @keyframes disabledPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.4; }
        }

        /* Current Flow Progress Section */
        .progress-section {
            display: none;
            margin-top: 45px;
        }

        .progress-section.visible {
            display: block;
            animation: surfaceFromDepth 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes surfaceFromDepth {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Reef Phase Structure */
        .reef-phases {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 28px;
            margin-bottom: 45px;
        }

        .phase-polyp {
            background: var(--reef-bg-primary);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border-subtle);
            border-radius: var(--border-radius-coral);
            padding: 28px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .phase-polyp::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at var(--x, 50%) var(--y, 50%), 
                rgba(32, 178, 170, 0.1) 0%, 
                transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .phase-polyp:hover::before {
            opacity: 1;
        }

        .phase-polyp.active {
            border-color: var(--reef-border-glow);
            background: var(--reef-bg-secondary);
            box-shadow: 0 0 40px rgba(32, 178, 170, 0.2);
            animation: activeGrowth 3s ease-in-out infinite;
        }

        @keyframes activeGrowth {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .phase-polyp.completed {
            border-color: rgba(255, 127, 80, 0.4);
            background: rgba(255, 127, 80, 0.08);
            box-shadow: 0 0 30px rgba(255, 127, 80, 0.15);
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .phase-nucleus {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--reef-bg-tertiary);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            color: var(--text-reef-secondary);
            transition: all 0.4s ease;
        }

        .phase-polyp.active .phase-nucleus {
            background: var(--sea-green-light);
            border-color: var(--sea-green);
            color: white;
            box-shadow: 0 0 20px rgba(32, 178, 170, 0.4);
            animation: nucleusPulse 2s ease-in-out infinite;
        }

        @keyframes nucleusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .phase-polyp.completed .phase-nucleus {
            background: var(--coral-primary);
            border-color: rgba(255, 127, 80, 0.6);
            color: white;
            box-shadow: 0 0 20px rgba(255, 127, 80, 0.4);
        }

        .phase-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-reef-primary);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .pattern-tentacles {
            list-style: none;
        }

        .pattern-organism {
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .pattern-organism:last-child {
            border-bottom: none;
        }

        .pattern-organism:hover {
            padding-left: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .pattern-symbiont {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-reef-muted);
            transition: all 0.4s ease;
            position: relative;
        }

        .pattern-organism.active .pattern-symbiont {
            background: var(--sea-green);
            box-shadow: 0 0 15px rgba(32, 178, 170, 0.6);
            animation: symbiontPulse 1.8s ease-in-out infinite;
        }

        @keyframes symbiontPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 15px rgba(32, 178, 170, 0.6);
            }
            50% { 
                transform: scale(1.3);
                box-shadow: 0 0 25px rgba(32, 178, 170, 0.8);
            }
        }

        .pattern-organism.completed .pattern-symbiont {
            background: var(--coral-primary);
            box-shadow: 0 0 12px rgba(255, 127, 80, 0.5);
        }

        .pattern-name {
            font-weight: 600;
            color: var(--text-reef-secondary);
            flex: 1;
            transition: color 0.3s ease;
        }

        .pattern-organism.active .pattern-name {
            color: var(--text-reef-accent);
            text-shadow: 0 0 10px rgba(32, 178, 170, 0.3);
        }

        .pattern-organism.completed .pattern-name {
            color: var(--text-reef-primary);
        }

        /* Results Treasure */
        .results-section {
            display: none;
            margin-top: 45px;
        }

        .results-section.visible {
            display: block;
            animation: surfaceFromDepth 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .treasure-card {
            background: var(--reef-bg-elevated);
            backdrop-filter: var(--reef-blur-medium);
            -webkit-backdrop-filter: var(--reef-blur-medium);
            border: 2px solid var(--reef-border-strong);
            border-radius: var(--border-radius-anemone);
            padding: 40px;
            text-align: center;
            box-shadow: var(--reef-shadow-medium), 
                        0 0 60px rgba(255, 127, 80, 0.15);
            position: relative;
            overflow: hidden;
        }

        .treasure-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, 
                rgba(255, 127, 80, 0.1) 0%, 
                transparent 60%);
            animation: treasureGlow 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes treasureGlow {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .treasure-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-reef-primary);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 127, 80, 0.3);
        }

        .treasure-description {
            color: var(--text-reef-secondary);
            margin-bottom: 30px;
            font-size: 1.2rem;
            line-height: 1.7;
        }

        .harvest-button {
            background: linear-gradient(135deg, 
                var(--coral-primary) 0%, 
                rgba(255, 127, 80, 0.9) 100%);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid rgba(255, 127, 80, 0.6);
            border-radius: var(--border-radius-coral);
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            padding: 18px 40px;
            cursor: pointer;
            transition: all 0.4s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: var(--reef-shadow-soft), 
                        0 0 30px rgba(255, 127, 80, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .harvest-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--reef-shadow-medium), 
                        0 0 50px rgba(255, 127, 80, 0.5);
            border-color: rgba(255, 127, 80, 0.9);
        }

        /* Management Laboratory */
        .lab-portal {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--reef-bg-secondary);
            backdrop-filter: var(--reef-blur-medium);
            -webkit-backdrop-filter: var(--reef-blur-medium);
            border: 2px solid var(--reef-border);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-reef-primary);
            font-size: 1.4rem;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 999;
            box-shadow: var(--reef-shadow-soft);
        }

        .lab-portal:hover {
            background: var(--reef-bg-tertiary);
            border-color: var(--reef-border-glow);
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--reef-shadow-medium), 0 0 30px rgba(32, 178, 170, 0.3);
        }

        /* Laboratory Modal */
        .lab-depths {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: var(--reef-blur-mystical);
            -webkit-backdrop-filter: var(--reef-blur-mystical);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 25px;
        }

        .lab-depths.visible {
            display: flex;
            animation: depthDive 0.5s ease-out;
        }

        @keyframes depthDive {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .laboratory {
            background: var(--reef-bg-modal);
            backdrop-filter: var(--reef-blur-mystical);
            -webkit-backdrop-filter: var(--reef-blur-mystical);
            border: 2px solid var(--reef-border-strong);
            border-radius: var(--border-radius-organic);
            padding: 45px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--reef-shadow-deep), 
                        0 0 100px rgba(0, 0, 0, 0.4);
            position: relative;
            animation: labAscent 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes labAscent {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .laboratory::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 50%, 
                rgba(32, 178, 170, 0.05) 100%);
            border-radius: var(--border-radius-organic);
            pointer-events: none;
        }

        .lab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            position: relative;
            z-index: 1;
        }

        .lab-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-reef-primary);
            text-shadow: 0 0 15px rgba(32, 178, 170, 0.3);
        }

        .lab-exit {
            background: var(--reef-bg-primary);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-reef-secondary);
            transition: all 0.3s ease;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .lab-exit:hover {
            background: var(--reef-bg-secondary);
            border-color: var(--reef-border-strong);
            color: var(--text-reef-primary);
            transform: rotate(90deg);
        }

        .lab-content {
            position: relative;
            z-index: 1;
        }

        .lab-section {
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--reef-border-subtle);
        }

        .lab-section:last-child {
            border-bottom: none;
        }

        .section-header {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-reef-primary);
            margin-bottom: 18px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .lab-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .control-organism {
            background: var(--reef-bg-secondary);
            backdrop-filter: var(--reef-blur-gentle);
            -webkit-backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border);
            border-radius: var(--border-radius-pearl);
            color: var(--text-reef-primary);
            font-size: 0.95rem;
            font-weight: 600;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .control-organism:hover {
            background: var(--reef-bg-tertiary);
            border-color: var(--reef-border-glow);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 178, 170, 0.15);
        }

        .control-organism.danger {
            border-color: rgba(255, 127, 80, 0.4);
            color: rgba(255, 127, 80, 0.9);
        }

        .control-organism.danger:hover {
            background: rgba(255, 127, 80, 0.1);
            border-color: rgba(255, 127, 80, 0.6);
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.15);
        }

        /* Responsive Reef */
        @media (max-width: 768px) {
            .container {
                padding: 25px 18px;
            }

            .header h1 {
                font-size: 3rem;
            }

            .header p {
                font-size: 1.1rem;
            }

            .coral-card {
                padding: 30px;
            }

            .coral-card-elevated {
                padding: 35px;
            }

            .reef-phases {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .laboratory {
                padding: 30px;
                margin: 20px;
            }

            .lab-portal {
                width: 52px;
                height: 52px;
                font-size: 1.2rem;
            }
        }

        /* Current Flow Loading */
        .current-loading {
            background: linear-gradient(90deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(32, 178, 170, 0.2) 50%,
                rgba(255, 255, 255, 0.1) 100%);
            background-size: 200% 100%;
            animation: currentShimmer 2s ease-in-out infinite;
        }

        @keyframes currentShimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Reef Reflection Effects */
        .reef-reflection {
            position: relative;
            overflow: hidden;
        }

        .reef-reflection::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%);
            transform: skewX(-20deg);
            transition: left 0.8s ease;
        }

        .reef-reflection:hover::after {
            left: 150%;
        }

        /* Progress Flow Animation */
        .progress-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .progress-header h3 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-reef-primary);
            text-shadow: 0 0 20px rgba(32, 178, 170, 0.3);
        }

        .progress-header p {
            color: var(--text-reef-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Interactive Hover Effects */
        .phase-polyp {
            cursor: pointer;
        }

        .phase-polyp:hover {
            transform: translateY(-2px);
            border-color: var(--reef-border-glow);
        }

        /* Add current lines to body */
        body {
            position: relative;
        }

        body > .current-lines {
            display: none;
        }

        /* Document Laboratory Styles */
        .document-opportunities {
            margin-top: 25px;
        }

        .opportunities-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .opportunities-header h4 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-reef-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(32, 178, 170, 0.3);
        }

        .opportunities-subtitle {
            color: var(--text-reef-secondary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .document-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .document-tier {
            background: var(--reef-bg-primary);
            backdrop-filter: var(--reef-blur-gentle);
            border: 2px solid var(--reef-border-subtle);
            border-radius: var(--border-radius-coral);
            padding: 20px;
            transition: all 0.3s ease;
        }

        .document-tier:hover {
            border-color: var(--reef-border-glow);
            background: var(--reef-bg-secondary);
        }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .tier-icon {
            font-size: 1.8rem;
            width: 40px;
            text-align: center;
        }

        .tier-info h5 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-reef-primary);
            margin-bottom: 4px;
        }

        .tier-audience {
            font-size: 0.9rem;
            color: var(--text-reef-tertiary);
        }

        .tier-documents {
            min-height: 60px;
        }

        .document-option {
            background: var(--reef-bg-secondary);
            border: 2px solid var(--reef-border-subtle);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .document-option:hover {
            border-color: var(--reef-border-glow);
            transform: translateY(-2px);
        }

        .document-option.selected {
            border-color: var(--sea-green);
            background: var(--sea-green-light);
            box-shadow: 0 0 15px rgba(32, 178, 170, 0.3);
        }

        .document-option .checkbox {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 18px;
            height: 18px;
            border: 2px solid var(--reef-border);
            border-radius: 4px;
            background: var(--reef-bg-primary);
            transition: all 0.3s ease;
        }

        .document-option.selected .checkbox {
            background: var(--sea-green);
            border-color: var(--sea-green);
        }

        .document-option.selected .checkbox::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .document-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-reef-primary);
            margin-bottom: 4px;
            padding-right: 35px;
        }

        .document-details {
            font-size: 0.85rem;
            color: var(--text-reef-secondary);
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .document-meta {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: var(--text-reef-tertiary);
        }

        .document-controls {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid var(--reef-border-subtle);
        }

        /* Document Generation Progress Styles */
        .document-generation-progress {
            margin-top: 25px;
        }

        .generation-status {
            background: var(--reef-bg-secondary);
            border: 2px solid var(--reef-border);
            border-radius: var(--border-radius-coral);
            padding: 20px;
        }

        .generation-current {
            text-align: center;
            margin-bottom: 15px;
        }

        .generation-current span {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-reef-primary);
            margin-bottom: 10px;
        }

        .generation-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--reef-bg-primary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .generation-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--sea-green), var(--tropical-blue));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .generation-stats {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-reef-secondary);
        }

        /* Document Results Styles */
        .document-results {
            margin-top: 25px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .results-header h4 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-reef-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 127, 80, 0.3);
        }

        .results-header p {
            color: var(--text-reef-secondary);
            font-size: 1rem;
        }

        .generated-documents-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .generated-document-card {
            background: var(--reef-bg-secondary);
            border: 2px solid var(--reef-border-glow);
            border-radius: var(--border-radius-pearl);
            padding: 15px;
            position: relative;
        }

        .generated-document-card .document-title {
            padding-right: 0;
            margin-bottom: 8px;
        }

        .generated-document-card .document-meta {
            justify-content: space-between;
        }

        .document-tier-badge {
            display: inline-block;
            background: var(--coral-primary);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        .enhanced-download {
            text-align: center;
            padding-top: 25px;
            border-top: 1px solid var(--reef-border-subtle);
        }

        /* Animation for document laboratory appearance */
        .document-laboratory-section.visible {
            animation: surfaceFromDepth 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .document-tiers {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .generated-documents-list {
                grid-template-columns: 1fr;
            }
            
            .document-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .document-controls button {
                width: 100%;
            }
        }

        /* OAuth2 Authentication Styles */
        .auth-card {
            margin-bottom: 24px;
            background: var(--reef-bg-secondary);
            border: 1px solid var(--reef-border);
            border-radius: 16px;
            overflow: hidden;
        }

        .auth-content {
            padding: 24px;
        }

        .auth-loading {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 24px;
            justify-content: center;
            color: var(--text-reef-secondary);
        }

        .auth-header h3 {
            color: var(--text-reef-primary);
            font-size: 1.4rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .auth-header p {
            color: var(--text-reef-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .auth-benefits {
            margin: 20px 0;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            color: var(--text-reef-secondary);
        }

        .benefit-icon {
            font-size: 1.1rem;
            min-width: 20px;
        }

        .auth-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            max-width: 300px;
            margin: 20px auto;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .auth-button-secondary {
            background: var(--reef-bg-tertiary);
            border: 1px solid var(--reef-border);
            color: var(--text-reef-secondary);
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .auth-button-secondary:hover {
            background: var(--reef-bg-elevated);
            color: var(--text-reef-primary);
            border-color: var(--reef-border-strong);
        }

        .button-icon {
            font-size: 1.2rem;
        }

        .auth-note {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-reef-muted);
            margin-top: 16px;
            font-style: italic;
        }

        .auth-user-info {
            background: var(--reef-bg-primary);
            border: 1px solid var(--reef-border-subtle);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            color: var(--text-reef-secondary);
        }

        .user-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .user-detail:last-child {
            margin-bottom: 0;
        }

        .user-label {
            font-weight: 600;
            color: var(--text-reef-accent);
        }

        .bio-loading-pulse {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--sea-green);
            animation: coralPulse 2s ease-in-out infinite;
        }

        @keyframes coralPulse {
            0%, 100% {
                opacity: 0.4;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        /* Responsive adjustments for auth */
        @media (max-width: 768px) {
            .auth-content {
                padding: 20px;
            }
            
            .auth-header h3 {
                font-size: 1.2rem;
            }
            
            .benefit-item {
                font-size: 0.9rem;
            }
        }

        /* Error Section Styles */
        .error-section {
            display: none;
            margin: 24px 0;
        }

        .error-section.visible {
            display: block;
        }

        .error-card {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 16px;
        }

        .error-content {
            padding: 24px;
            text-align: center;
        }

        .error-content h3 {
            color: rgba(255, 107, 107, 0.95);
            font-size: 1.4rem;
            margin-bottom: 12px;
        }

        .error-content p {
            color: var(--text-reef-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Management Panel Styles */
        .management-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--reef-bg-elevated);
            border: 1px solid var(--reef-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .management-toggle:hover {
            background: var(--reef-bg-modal);
            transform: scale(1.1);
        }

        .management-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .management-content {
            background: var(--reef-bg-modal);
            border: 1px solid var(--reef-border);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .management-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--reef-border-subtle);
        }

        .management-header h3 {
            color: var(--text-reef-primary);
            margin: 0;
        }

        .close-management {
            background: none;
            border: none;
            color: var(--text-reef-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-management:hover {
            background: var(--reef-bg-tertiary);
            color: var(--text-reef-primary);
        }

        .management-body {
            padding: 20px;
            color: var(--text-reef-secondary);
        }
    </style>
</head>
<body>
    <div class="current-lines"></div>
    
    <div class="container">
        <header class="header">
            <h1>Fabric Studio</h1>
            <p>Powered by Daniel Miessler's Fabric framework, this studio makes advanced text analysis accessible to everyone. Transform dense documents into 13 distinct insight files with just a few clicks.</p>
        </header>

        <!-- OAuth2 Authentication Section (Hidden by default) -->
        <div id="auth-section" class="coral-card auth-card" style="display: none;">
            <div class="auth-status" id="auth-status">
                <div class="auth-loading">
                    <div class="bio-loading-pulse"></div>
                    <span>Checking authentication status...</span>
                </div>
            </div>
            
            <div id="auth-unauthenticated" class="auth-content" style="display: none;">
                <div class="auth-header">
                    <h3>🔑 YouTube Authentication Required</h3>
                    <p>To access real YouTube transcripts and bypass bot detection, please authenticate with your Google account.</p>
                </div>
                <div class="auth-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">✅</span>
                        <span>Access to all YouTube videos with captions</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">⚡</span>
                        <span>Faster, more reliable transcript downloads</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">🔒</span>
                        <span>Secure OAuth2 authentication</span>
                    </div>
                </div>
                <button id="login-btn" class="bio-button reef-reflection auth-button">
                    <span class="button-icon">🚀</span>
                    Authenticate with Google
                </button>
                <p class="auth-note">Without authentication, the system will use simulation mode with placeholder content.</p>
            </div>
            
            <div id="auth-authenticated" class="auth-content" style="display: none;">
                <div class="auth-header">
                    <h3>✅ Authenticated Successfully</h3>
                    <p>You're connected to YouTube! Ready to process real video transcripts.</p>
                </div>
                <div class="auth-user-info" id="auth-user-info">
                    <!-- User info will be populated by JavaScript -->
                </div>
                <button id="logout-btn" class="bio-button auth-button-secondary">
                    Logout
                </button>
            </div>
        </div>

        <main class="coral-card coral-card-elevated">
            <!-- Input Method Selection -->
            <div class="input-method-selector">
                <h3 style="color: var(--text-reef-accent); margin-bottom: 16px; font-size: 18px;">Choose Your Content Input Method</h3>
                <div class="method-tabs">
                    <button id="tab-upload" class="method-tab active" data-method="upload">📁 Upload File</button>
                    <button id="tab-paste" class="method-tab" data-method="paste">📝 Paste Text</button>
                </div>
            </div>

            <!-- File Upload Method -->
            <div id="method-upload" class="input-method active">
                <div class="input-group">
                    <label for="transcript-file" class="input-label">Upload Transcript File</label>
                    <div id="dropzone" class="dropzone">
                        <input 
                            type="file" 
                            id="transcript-file" 
                            class="file-input" 
                            accept=".txt,.vtt,.srt,.md,.rtf"
                            hidden
                        />
                        <div class="dropzone-content">
                            <div class="dropzone-icon">📄</div>
                            <div class="dropzone-text">
                                <strong>Drop your transcript file here</strong>
                                <p>or <span class="file-browse-link">browse to select</span></p>
                                <small>Supports: TXT, VTT, SRT, MD, RTF (max 10MB)</small>
                            </div>
                        </div>
                    </div>
                    <div id="file-info" class="file-info" style="display: none;"></div>
                </div>
            </div>

            <!-- Paste Text Method -->
            <div id="method-paste" class="input-method">
                <div class="input-group">
                    <label for="transcript-text" class="input-label">Paste Your Content</label>
                    <textarea 
                        id="transcript-text" 
                        class="transcript-textarea" 
                        placeholder="Paste your transcript, meeting notes, lecture content, or any text you'd like to analyze..."
                        rows="8"
                    ></textarea>
                    <div class="text-stats">
                        <span id="char-count">0 characters</span>
                        <span id="word-count">0 words</span>
                        <span id="time-estimate">~0 min estimated</span>
                    </div>
                </div>
            </div>


            <!-- Content Preview -->
            <div id="content-preview" class="content-preview" style="display: none;">
                <h4>Content Preview</h4>
                <div id="preview-text" class="preview-text"></div>
                <div class="preview-stats">
                    <span id="preview-format"></span>
                    <span id="preview-size"></span>
                </div>
            </div>

            <!-- Processing Recommendations -->
            <div class="reef-info-note">
                <div class="info-icon">💎</div>
                <div class="info-content">
                    <strong>Content Processing Recommendations:</strong>
                    <ul>
                        <li>✅ <strong>Excellent Results</strong>: Meeting recordings, lectures, podcasts (15-45 min content)</li>
                        <li>⚠️ <strong>Great Results</strong>: Long-form content, interviews, webinars (45-90 min content)</li>
                        <li>🔄 <strong>Good Results</strong>: Extended content, full courses (90+ min content)</li>
                    </ul>
                    <p style="color: rgba(255, 255, 255, 0.9);"><strong>Content density matters more than duration</strong> - a dense 30-minute lecture may process like a 90-minute casual conversation.</p>
                    <div style="margin-top: 12px; padding: 12px; background: rgba(32, 178, 170, 0.15); border: 1px solid rgba(32, 178, 170, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.95);">
                        <strong>🚀 The Magic:</strong> Upload any transcript or paste your content to get professional-grade analysis from 13 specialized Fabric patterns - the same patterns used by thousands of knowledge workers worldwide!
                    </div>
                </div>
            </div>

            <!-- Content Resources Section -->
            <div class="reef-info-note resources-section" style="margin-top: 25px; margin-bottom: 25px;">
                <div class="info-icon">📚</div>
                <div class="info-content">
                    <strong>Content Resources</strong>
                    <p style="color: rgba(255, 255, 255, 0.9); margin-top: 8px; margin-bottom: 16px;">
                        Unlock the full potential of Fabric Studio by discovering the best sources for high-quality content to analyze.
                    </p>
                    
                    <div class="resources-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                        <div class="resource-category">
                            <h4 style="color: var(--sea-green); font-size: 1rem; margin-bottom: 12px; font-weight: 600;">🎥 YouTube Transcript Tools</h4>
                            <div style="font-size: 0.9rem; line-height: 1.5;">
                                <a href="https://www.transcribr.io/" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none; margin-bottom: 6px; hover: text-decoration: underline;">• Transcribr.io</a>
                                <a href="https://tactiq.io/tools/youtube-transcript" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none; margin-bottom: 6px;">• Tactiq YouTube Transcript</a>
                                <a href="https://notegpt.io/youtube-transcript-generator" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none; margin-bottom: 6px;">• NoteGPT Transcript Generator</a>
                                <a href="https://www.youtube-transcript.io/" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none; margin-bottom: 6px;">• YouTube-Transcript.io</a>
                                <a href="https://youtubetotranscript.com/" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none; margin-bottom: 6px;">• YouTube to Transcript</a>
                                <a href="https://kome.ai/tools/youtube-transcript-generator" target="_blank" style="display: block; color: var(--text-reef-accent); text-decoration: none;">• Kome.ai Transcript Generator</a>
                            </div>
                        </div>
                        
                        <div class="resource-category">
                            <h4 style="color: var(--coral-primary); font-size: 1rem; margin-bottom: 12px; font-weight: 600;">💼 Meeting & Collaboration</h4>
                            <div style="font-size: 0.9rem; line-height: 1.5; color: rgba(255, 255, 255, 0.9);">
                                <p style="margin-bottom: 8px;"><strong>Video Conferencing:</strong> Zoom, Teams, Google Meet, Webex recordings</p>
                                <p style="margin-bottom: 8px;"><strong>Professional Services:</strong> Otter.ai, Rev.com, Trint, Descript</p>
                                <p style="margin-bottom: 8px;"><strong>Educational Platforms:</strong> Coursera, Udemy, Khan Academy</p>
                                <p style="margin-bottom: 0;"><strong>Podcast Content:</strong> Spotify, Apple Podcasts, dedicated transcription services</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px; padding: 12px; background: rgba(32, 178, 170, 0.12); border: 1px solid rgba(32, 178, 170, 0.25); border-radius: 8px; color: rgba(255, 255, 255, 0.95); font-size: 0.9rem;">
                        💡 <strong>Pro Tip:</strong> Whether you're processing meeting transcripts, educational content, or research materials - these curated resources will help you source meaningful content for comprehensive AI-powered insights.
                    </div>
                </div>
            </div>

            <button id="process-btn" class="bio-button reef-reflection" disabled>Start Analysis</button>
        </main>

        <div id="progress-section" class="progress-section">
            <div class="coral-card">
                <div class="progress-header">
                    <h3>Analysis in Progress</h3>
                    <p>Your content is being analyzed through Fabric Studio using 13 specialized patterns across 4 processing phases</p>
                </div>

                <div class="reef-phases">
                    <div class="phase-polyp" data-phase="1">
                        <div class="phase-header">
                            <div class="phase-nucleus">1</div>
                            <span class="phase-title">Primary Extraction</span>
                        </div>
                        <ul class="pattern-tentacles">
                            <li class="pattern-organism" data-pattern="youtube_summary">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Content Summary</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_core_message">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Core Message</span>
                            </li>
                        </ul>
                    </div>

                    <div class="phase-polyp" data-phase="2">
                        <div class="phase-header">
                            <div class="phase-nucleus">2</div>
                            <span class="phase-title">Content Analysis</span>
                        </div>
                        <ul class="pattern-tentacles">
                            <li class="pattern-organism" data-pattern="extract_wisdom">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Wisdom</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_insights">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Insights</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_ideas">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Ideas</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_patterns">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Patterns</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_recommendations">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Recommendations</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_predictions">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Predictions</span>
                            </li>
                        </ul>
                    </div>

                    <div class="phase-polyp" data-phase="3">
                        <div class="phase-header">
                            <div class="phase-nucleus">3</div>
                            <span class="phase-title">Knowledge Graph Building</span>
                        </div>
                        <ul class="pattern-tentacles">
                            <li class="pattern-organism" data-pattern="extract_references">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract References</span>
                            </li>
                            <li class="pattern-organism" data-pattern="extract_questions">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Extract Questions</span>
                            </li>
                            <li class="pattern-organism" data-pattern="create_tags">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Create Tags</span>
                            </li>
                        </ul>
                    </div>

                    <div class="phase-polyp" data-phase="4">
                        <div class="phase-header">
                            <div class="phase-nucleus">4</div>
                            <span class="phase-title">Synthesis Materials</span>
                        </div>
                        <ul class="pattern-tentacles">
                            <li class="pattern-organism" data-pattern="create_5_sentence_summary">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">Create 5 Sentence Summary</span>
                            </li>
                            <li class="pattern-organism" data-pattern="to_flashcards">
                                <div class="pattern-symbiont"></div>
                                <span class="pattern-name">To Flashcards</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="results-section" class="results-section">
            <div class="coral-card">
                <div class="treasure-card">
                    <h3 class="treasure-title">Analysis Complete!</h3>
                    <p class="treasure-description">Your content has been thoroughly analyzed through Fabric Studio. All 13 fabric patterns have been processed and are ready for download.</p>
                    <a href="#" id="download-btn" class="harvest-button reef-reflection">Download Insights</a>
                </div>
            </div>
        </div>

        <!-- Error Section -->
        <div id="error-section" class="error-section">
            <div class="coral-card error-card">
                <div class="error-content">
                    <h3>⚠️ Processing Error</h3>
                    <p id="error-message">An error occurred during processing.</p>
                    <button id="retry-btn" class="bio-button reef-reflection">Try Again</button>
                </div>
            </div>
        </div>

        <!-- Document Laboratory Section -->
        <div id="document-laboratory-section" class="progress-section">
            <div class="coral-card coral-card-elevated">
                <div class="progress-header">
                    <h3>🧬 Document Studio Detected Advanced Content</h3>
                    <p>Your content analysis reveals opportunities for professional document generation across 4 specialized tiers</p>
                </div>

                <!-- Document Opportunities Display -->
                <div id="document-opportunities" class="document-opportunities" style="display: none;">
                    <div class="opportunities-header">
                        <h4>Recommended Document Portfolio</h4>
                        <p class="opportunities-subtitle">Select documents to generate based on your content analysis</p>
                    </div>
                    
                    <div class="document-tiers">
                        <!-- Technical Implementation Tier -->
                        <div class="document-tier" data-tier="technical">
                            <div class="tier-header">
                                <div class="tier-icon">👩‍💻</div>
                                <div class="tier-info">
                                    <h5>Technical Implementation</h5>
                                    <span class="tier-audience">Developers • DevOps • Engineers</span>
                                </div>
                            </div>
                            <div class="tier-documents"></div>
                        </div>

                        <!-- Strategic Business Tier -->
                        <div class="document-tier" data-tier="strategic">
                            <div class="tier-header">
                                <div class="tier-icon">📊</div>
                                <div class="tier-info">
                                    <h5>Strategic Business</h5>
                                    <span class="tier-audience">Executives • Product Managers • CTOs</span>
                                </div>
                            </div>
                            <div class="tier-documents"></div>
                        </div>

                        <!-- Educational & Training Tier -->
                        <div class="document-tier" data-tier="educational">
                            <div class="tier-header">
                                <div class="tier-icon">🎓</div>
                                <div class="tier-info">
                                    <h5>Educational & Training</h5>
                                    <span class="tier-audience">Training Teams • HR • Developers</span>
                                </div>
                            </div>
                            <div class="tier-documents"></div>
                        </div>

                        <!-- Operational Excellence Tier -->
                        <div class="document-tier" data-tier="operational">
                            <div class="tier-header">
                                <div class="tier-icon">⚙️</div>
                                <div class="tier-info">
                                    <h5>Operational Excellence</h5>
                                    <span class="tier-audience">Support Teams • Operations • C-Suite</span>
                                </div>
                            </div>
                            <div class="tier-documents"></div>
                        </div>
                    </div>

                    <div class="document-controls">
                        <button id="select-all-documents" class="bio-button" style="margin-right: 15px;">Select All Recommended</button>
                        <button id="generate-documents-btn" class="bio-button" disabled>Generate Selected Documents</button>
                    </div>
                </div>

                <!-- Document Generation Progress -->
                <div id="document-generation-progress" class="document-generation-progress" style="display: none;">
                    <div class="progress-header">
                        <h4>🧬 Document Studio Active</h4>
                        <p>Generating professional documents from your content analysis...</p>
                    </div>
                    
                    <div class="generation-status">
                        <div class="generation-current">
                            <span id="current-document-title">Initializing...</span>
                            <div class="generation-progress-bar">
                                <div class="generation-progress-fill" id="generation-progress-fill"></div>
                            </div>
                        </div>
                        <div class="generation-stats">
                            <span id="documents-generated">0</span> / <span id="total-documents">0</span> documents completed
                        </div>
                    </div>
                </div>

                <!-- Enhanced Results -->
                <div id="document-results" class="document-results" style="display: none;">
                    <div class="results-header">
                        <h4>🧬 Document Studio Complete</h4>
                        <p>Professional document suite generated successfully</p>
                    </div>
                    
                    <div class="document-portfolio">
                        <div id="generated-documents-list" class="generated-documents-list">
                            <!-- Generated documents will be populated here -->
                        </div>
                    </div>
                    
                    <div class="enhanced-download">
                        <a href="#" id="enhanced-download-btn" class="harvest-button reef-reflection">
                            Download Enhanced Results (Patterns + Documents)
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="lab-portal" id="lab-portal">
        🧪
    </div>

    <div id="lab-modal" class="lab-depths">
        <div class="laboratory">
            <div class="lab-header">
                <h2 class="lab-title">Fabric Studio Console</h2>
                <button id="lab-exit" class="lab-exit">×</button>
            </div>
            
            <div class="lab-content">
                <div class="lab-section">
                    <h3 class="section-header">API Key Configuration</h3>
                    <div class="lab-controls">
                        <button class="control-organism" onclick="configureApiKeys()">Configure API Keys</button>
                        <button class="control-organism" onclick="testApiConnections()">Test API Connections</button>
                        <button class="control-organism" onclick="viewCurrentKeys()">View Current Configuration</button>
                    </div>
                </div>
                
                <div class="lab-section">
                    <h3 class="section-header">Server Status</h3>
                    <div class="lab-controls">
                        <button class="control-organism" onclick="checkReefStatus()">Check Server Status</button>
                        <button class="control-organism" onclick="viewExplorationHistory()">View Processing History</button>
                        <button class="control-organism" onclick="monitorCurrents()">Monitor System Health</button>
                    </div>
                </div>
                
                <div class="lab-section">
                    <h3 class="section-header">File Management</h3>
                    <div class="lab-controls">
                        <button class="control-organism" onclick="cleanReef()">Clean Old Files</button>
                        <button class="control-organism" onclick="refreshEcosystem()">Refresh File System</button>
                        <button class="control-organism danger" onclick="resetLaboratory()">Clear All Data</button>
                    </div>
                </div>
                
                <div class="lab-section">
                    <h3 class="section-header">Server Controls</h3>
                    <div class="lab-controls">
                        <button class="control-organism danger" onclick="restartReef()">Restart Server</button>
                        <button class="control-organism danger" onclick="shutdownLab()">Shutdown Server</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Configuration Modal -->
    <div id="api-key-modal" class="lab-depths">
        <div class="laboratory">
            <div class="lab-header">
                <h2 class="lab-title">API Key Configuration</h2>
                <button id="api-key-exit" class="lab-exit">×</button>
            </div>
            
            <div class="lab-content">
                <div class="lab-section">
                    <h3 class="section-header">LLM Provider API Keys</h3>
                    <p style="color: var(--text-reef-secondary); margin-bottom: 25px; font-size: 0.95rem;">
                        Configure API keys for fallback model support. Keys are stored securely on the server.
                    </p>
                    
                    <div class="input-group">
                        <label for="anthropic-key" class="input-label">Anthropic API Key (Claude Models)</label>
                        <input 
                            type="password" 
                            id="anthropic-key" 
                            class="url-input" 
                            placeholder="sk-ant-api03-..."
                            style="font-family: monospace; font-size: 0.9rem;"
                        />
                    </div>
                    
                    <div class="input-group">
                        <label for="openai-key" class="input-label">OpenAI API Key (GPT Models)</label>
                        <input 
                            type="password" 
                            id="openai-key" 
                            class="url-input" 
                            placeholder="sk-proj-..."
                            style="font-family: monospace; font-size: 0.9rem;"
                        />
                    </div>
                    
                    <div class="input-group">
                        <label for="google-key" class="input-label">Google API Key (Gemini Models)</label>
                        <input 
                            type="password" 
                            id="google-key" 
                            class="url-input" 
                            placeholder="AIzaSy..."
                            style="font-family: monospace; font-size: 0.9rem;"
                        />
                    </div>
                    
                    <div class="lab-controls" style="margin-top: 30px;">
                        <button class="control-organism" onclick="saveApiKeys()" style="background: var(--sea-green); color: white;">Save Configuration</button>
                        <button class="control-organism" onclick="loadApiKeys()">Load Current Keys</button>
                        <button class="control-organism danger" onclick="clearApiKeys()">Clear All Keys</button>
                    </div>
                </div>
                
                <div class="lab-section">
                    <h3 class="section-header">Fallback Model Configuration</h3>
                    <p style="color: var(--text-reef-secondary); margin-bottom: 25px; font-size: 0.95rem;">
                        Configure the order of model fallbacks when API calls fail.
                    </p>
                    
                    <div class="input-group">
                        <label for="fallback-models" class="input-label">Fallback Model Order</label>
                        <textarea 
                            id="fallback-models" 
                            class="url-input" 
                            rows="6" 
                            placeholder="claude-3-5-sonnet-20241022&#10;gpt-4o&#10;OpenAI o3&#10;gpt-4o-mini&#10;claude-3-5-haiku-20241022&#10;gpt-4-turbo"
                            style="font-family: monospace; font-size: 0.9rem; resize: vertical;"
                        ></textarea>
                    </div>
                    
                    <div class="lab-controls" style="margin-top: 20px;">
                        <button class="control-organism" onclick="saveFallbackConfig()">Save Fallback Order</button>
                        <button class="control-organism" onclick="resetToDefaults()">Reset to Defaults</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const processBtn = document.getElementById('process-btn');
        const transcriptFile = document.getElementById('transcript-file');
        const transcriptText = document.getElementById('transcript-text');
        const dropzone = document.getElementById('dropzone');
        const fileInfo = document.getElementById('file-info');
        const contentPreview = document.getElementById('content-preview');
        const previewText = document.getElementById('preview-text');
        const authSection = document.getElementById('auth-section');
        const progressSection = document.getElementById('progress-section');
        const resultsSection = document.getElementById('results-section');
        const downloadBtn = document.getElementById('download-btn');
        
        // Method tabs and containers
        const methodTabs = document.querySelectorAll('.method-tab');
        const inputMethods = document.querySelectorAll('.input-method');
        
        // Stats elements
        const charCount = document.getElementById('char-count');
        const wordCount = document.getElementById('word-count');
        const timeEstimate = document.getElementById('time-estimate');
        const previewFormat = document.getElementById('preview-format');
        const previewSize = document.getElementById('preview-size');
        
        // Global state
        let currentContent = '';
        let currentMethod = 'upload';
        let currentFile = null;

        // Initialize universal interface
        function initializeUniversalInterface() {
            // Method tab switching
            methodTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const method = e.target.dataset.method;
                    switchInputMethod(method);
                });
            });

            // File upload and drag-and-drop
            dropzone.addEventListener('click', () => transcriptFile.click());
            dropzone.addEventListener('dragover', handleDragOver);
            dropzone.addEventListener('dragleave', handleDragLeave);
            dropzone.addEventListener('drop', handleFileDrop);
            transcriptFile.addEventListener('change', handleFileSelect);

            // Text input
            transcriptText.addEventListener('input', handleTextInput);
            transcriptText.addEventListener('paste', handleTextPaste);

            // YouTube URL input (only when that method is active)
            // urlInput.addEventListener('input', handleUrlInput); // Removed - YouTube URL not supported in cloud deployment

            // Initialize with upload method active
            switchInputMethod('upload');
            updateProcessButton();
        }

        function switchInputMethod(method) {
            currentMethod = method;

            // Update tabs
            methodTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.method === method);
            });

            // Update method containers
            inputMethods.forEach(container => {
                container.classList.toggle('active', container.id === `method-${method}`);
            });

            // Hide auth section (YouTube not supported in cloud deployment)
            authSection.style.display = 'none';

            // Clear content and reset
            currentContent = '';
            currentFile = null;
            hideContentPreview();
            updateProcessButton();
            updateTextStats();
        }

        // File handling functions
        function handleDragOver(e) {
            e.preventDefault();
            dropzone.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            dropzone.classList.remove('drag-over');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            dropzone.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file size (10MB limit)
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showNotification('File size exceeds 10MB limit. Please choose a smaller file.', 'error');
                return;
            }

            // Validate file type
            const allowedTypes = ['.txt', '.vtt', '.srt', '.md', '.rtf'];
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            if (!allowedTypes.includes(fileExt)) {
                showNotification('Unsupported file type. Please upload TXT, VTT, SRT, MD, or RTF files.', 'error');
                return;
            }

            currentFile = file;
            showFileInfo(file);

            // Read file content
            const reader = new FileReader();
            reader.onload = (e) => {
                currentContent = e.target.result;
                detectAndPreviewContent(currentContent, fileExt);
                updateProcessButton();
            };
            reader.onerror = () => {
                showNotification('Error reading file. Please try again.', 'error');
            };
            reader.readAsText(file);
        }

        function showFileInfo(file) {
            const formatSize = (bytes) => {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            };

            fileInfo.innerHTML = `
                <div class="file-info-name">${file.name}</div>
                <div class="file-info-details">
                    Size: ${formatSize(file.size)} | Type: ${file.type || 'Unknown'} | Modified: ${new Date(file.lastModified).toLocaleDateString()}
                </div>
            `;
            fileInfo.style.display = 'block';
        }

        // Text handling functions
        function handleTextInput(e) {
            currentContent = e.target.value;
            updateTextStats();
            updateProcessButton();
            
            if (currentContent.length > 100) {
                detectAndPreviewContent(currentContent, 'paste');
            } else {
                hideContentPreview();
            }
        }

        function handleTextPaste(e) {
            // Allow normal paste, then process after a short delay
            setTimeout(() => {
                currentContent = e.target.value;
                updateTextStats();
                updateProcessButton();
                if (currentContent.length > 100) {
                    detectAndPreviewContent(currentContent, 'paste');
                }
            }, 100);
        }

        // handleUrlInput removed - YouTube URL not supported in cloud deployment

        function updateTextStats() {
            if (currentMethod !== 'paste') return;

            const text = transcriptText.value;
            const chars = text.length;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const estimatedMinutes = Math.ceil(words / 150); // Average reading speed

            charCount.textContent = `${chars.toLocaleString()} characters`;
            wordCount.textContent = `${words.toLocaleString()} words`;
            timeEstimate.textContent = `~${estimatedMinutes} min estimated`;
        }

        // Content preview and detection
        function detectAndPreviewContent(content, source) {
            if (!content || content.length < 100) return;

            const preview = content.substring(0, 500) + (content.length > 500 ? '...' : '');
            const format = detectContentFormat(content, source);
            
            previewText.textContent = preview;
            previewFormat.textContent = `Format: ${format}`;
            previewSize.textContent = `Size: ${(content.length / 1024).toFixed(1)} KB`;
            
            contentPreview.style.display = 'block';
        }

        function detectContentFormat(content, source) {
            if (source === '.vtt' || content.includes('WEBVTT')) return 'WebVTT Subtitles';
            if (source === '.srt' || /\d+\n\d{2}:\d{2}:\d{2},\d{3}/.test(content)) return 'SRT Subtitles';
            if (content.includes('SPEAKER_') || content.includes('[SPEAKER')) return 'Speaker-labeled Transcript';
            if (/\d{2}:\d{2}:\d{2}/.test(content)) return 'Timestamped Transcript';
            if (source === 'paste') return 'Plain Text Content';
            return 'Text Document';
        }

        function hideContentPreview() {
            contentPreview.style.display = 'none';
        }

        function updateProcessButton() {
            let hasContent = false;
            
            switch (currentMethod) {
                case 'upload':
                    hasContent = currentContent && currentContent.trim().length > 0;
                    break;
                case 'paste':
                    hasContent = currentContent && currentContent.trim().length > 50;
                    break;
            }

            processBtn.disabled = !hasContent || isProcessing;
            
            if (hasContent && !isProcessing) {
                processBtn.textContent = 'Start Analysis';
                processBtn.classList.remove('bio-button-disabled');
            } else if (isProcessing) {
                processBtn.textContent = 'Processing...';
                processBtn.classList.add('bio-button-disabled');
            } else {
                processBtn.textContent = 'Select Content to Analyze';
                processBtn.classList.add('bio-button-disabled');
            }
        }
        const labPortal = document.getElementById('lab-portal');
        const labModal = document.getElementById('lab-modal');
        const labExit = document.getElementById('lab-exit');
        const apiKeyModal = document.getElementById('api-key-modal');
        const apiKeyExit = document.getElementById('api-key-exit');

        // Document Studio Elements
        const documentLaboratorySection = document.getElementById('document-laboratory-section');
        const documentOpportunities = document.getElementById('document-opportunities');
        const documentGenerationProgress = document.getElementById('document-generation-progress');
        const documentResults = document.getElementById('document-results');
        const selectAllDocumentsBtn = document.getElementById('select-all-documents');
        const generateDocumentsBtn = document.getElementById('generate-documents-btn');
        const enhancedDownloadBtn = document.getElementById('enhanced-download-btn');

        // Processing state
        let isProcessing = false;
        let currentProcessId = null;
        let socket = null;

        // Document Studio state
        let documentOpportunityData = null;
        let selectedDocuments = [];
        let isGeneratingDocuments = false;

        // WebSocket connection handled by app.js Fabric Studio
        function initializeWebSocket() {
            // Disabled - WebSocket handled by app.js to prevent duplicate connections
            return;
            
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            socket = new WebSocket(wsUrl);
            
            socket.onopen = function(event) {
                console.log('WebSocket connected');
            };
            
            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            socket.onclose = function(event) {
                console.log('WebSocket disconnected');
                // Only attempt to reconnect if we were processing something
                if (isProcessing) {
                    setTimeout(initializeWebSocket, 5000);
                }
            };
            
            socket.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        }

        // Handle WebSocket messages
        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'progress':
                    updateProgress(data.pattern, data.phase, data.completed);
                    break;
                case 'process_completed':
                    processComplete(data.processId);
                    break;
                case 'process_failed':
                    processError(data.error);
                    break;
                case 'processing_stopped':
                    processError('Processing stopped by user request');
                    break;
                case 'document_opportunities':
                    showDocumentOpportunities(data);
                    break;
                case 'document_generation_started':
                    startDocumentGeneration(data);
                    break;
                case 'document_progress':
                    updateDocumentGenerationProgress(data);
                    break;
                case 'document_generation_complete':
                    completeDocumentGeneration(data);
                    break;
                case 'document_generation_failed':
                    documentGenerationError(data.error);
                    break;
                default:
                    console.log('Unknown WebSocket message type:', data.type);
            }
        }

        // Event Listeners
        processBtn.addEventListener('click', beginDeepAnalysis);
        // urlInput.addEventListener('keypress', (e) => {
        //     if (e.key === 'Enter') beginDeepAnalysis();
        // }); // Removed - YouTube URL not supported in cloud deployment
        // downloadBtn.addEventListener('click', harvestResults); // Removed - handled by app.js
        labPortal.addEventListener('click', openLaboratory);
        labExit.addEventListener('click', closeLaboratory);
        labModal.addEventListener('click', (e) => {
            if (e.target === labModal) closeLaboratory();
        });
        apiKeyExit.addEventListener('click', closeApiKeyModal);
        apiKeyModal.addEventListener('click', (e) => {
            if (e.target === apiKeyModal) closeApiKeyModal();
        });

        // Document Studio Event Listeners
        selectAllDocumentsBtn.addEventListener('click', selectAllRecommendedDocuments);
        generateDocumentsBtn.addEventListener('click', generateSelectedDocuments);
        enhancedDownloadBtn.addEventListener('click', harvestEnhancedResults);

        // Particle interaction effects
        document.addEventListener('mousemove', (e) => {
            const phasePolyps = document.querySelectorAll('.phase-polyp');
            phasePolyps.forEach(polyp => {
                const rect = polyp.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                polyp.style.setProperty('--x', x + '%');
                polyp.style.setProperty('--y', y + '%');
            });
        });

        // Processing functions - Delegate to Fabric Studio
        async function beginDeepAnalysis() {
            // Use the Fabric Studio handler from app.js
            if (window.app && window.app.startProcessing) {
                return window.app.startProcessing();
            }
            
            // This function is now handled by Fabric Studio
            showNotification('Fabric Studio loading...', 'info');
            return;

            if (isProcessing) return;

            isProcessing = true;
            currentProcessId = null;

            // Update UI
            processBtn.disabled = true;
            processBtn.textContent = 'Analyzing...';
            // urlInput.disabled = true; // Removed - YouTube URL not supported

            // Show progress section
            progressSection.classList.add('visible');
            resultsSection.classList.remove('visible');

            // Reset all organisms
            resetReefState();

            try {
                const response = await fetch('/api/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ youtubeUrl: url }),
                });

                const data = await response.json();
                
                if (response.ok) {
                    currentProcessId = data.processId;
                    showNotification('Analysis initiated! Processing your content...', 'success');
                } else {
                    throw new Error(data.message || data.error || 'Failed to start processing');
                }
            } catch (error) {
                processError(error.message);
            }
        }

        function updateProgress(pattern, phase, completed) {
            // Update pattern status
            const patternElement = document.querySelector(`[data-pattern="${pattern}"]`);
            if (patternElement) {
                if (completed) {
                    patternElement.classList.remove('active');
                    patternElement.classList.add('completed');
                } else {
                    patternElement.classList.add('active');
                }
            }

            // Update phase status
            const phaseElement = document.querySelector(`[data-phase="${phase}"]`);
            if (phaseElement) {
                if (completed) {
                    // Check if all patterns in this phase are completed
                    const patternsInPhase = phaseElement.querySelectorAll('.pattern-organism');
                    const completedPatterns = phaseElement.querySelectorAll('.pattern-organism.completed');
                    
                    if (patternsInPhase.length === completedPatterns.length) {
                        phaseElement.classList.remove('active');
                        phaseElement.classList.add('completed');
                    }
                } else {
                    phaseElement.classList.add('active');
                }
            }
        }

        function processComplete(processId) {
            currentProcessId = processId;
            
            // Show results section
            resultsSection.classList.add('visible');
            
            // Download handled by app.js click handler (no href needed)
            
            // Reset button
            processBtn.disabled = false;
            processBtn.textContent = 'Start Analysis';
            // urlInput.disabled = false; // Removed - YouTube URL not supported
            isProcessing = false;

            showNotification('Analysis complete! All patterns have been successfully processed.', 'success');

            // Document opportunities analysis handled server-side
        }

        function processError(message) {
            showNotification(`Processing error: ${message}`, 'error');
            
            // Reset UI state
            isProcessing = false;
            updateProcessButton();
            
            // Re-enable inputs (YouTube not supported in cloud deployment)
            transcriptText.disabled = false;
            transcriptFile.disabled = false;
        }

        function harvestResults() {
            if (currentProcessId) {
                // Trigger download
                window.location.href = `/api/download/${currentProcessId}`;
                showNotification('Downloading your analysis results...', 'info');
            }
        }

        function resetReefState() {
            // Reset all phases
            document.querySelectorAll('.phase-polyp').forEach(polyp => {
                polyp.classList.remove('active', 'completed');
            });
            
            // Reset all patterns
            document.querySelectorAll('.pattern-organism').forEach(organism => {
                organism.classList.remove('active', 'completed');
            });
        }

        // Studio functions
        function openLaboratory() {
            labModal.classList.add('visible');
        }

        function closeLaboratory() {
            labModal.classList.remove('visible');
        }

        function checkReefStatus() {
            fetch('/api/management/status')
                .then(response => response.json())
                .then(data => {
                    const uptime = data.server.uptimeFormatted;
                    const activeProcesses = data.processes.active;
                    const fabricStatus = data.server.fabricAvailable ? 'Available' : 'Not Available';
                    showNotification(`Server: Online (${uptime}). Active processes: ${activeProcesses}. Fabric: ${fabricStatus}`, 'info');
                })
                .catch(error => {
                    showNotification('Unable to check server status', 'error');
                });
        }

        function viewExplorationHistory() {
            fetch('/api/management/history')
                .then(response => response.json())
                .then(data => {
                    const totalAnalyses = data.length;
                    const completedAnalyses = data.filter(item => item.filesCount > 0).length;
                    showNotification(`Processing History: ${totalAnalyses} total analyses, ${completedAnalyses} completed successfully`, 'info');
                })
                .catch(error => {
                    showNotification('Unable to load processing history', 'error');
                });
        }

        function monitorCurrents() {
            fetch('/api/management/status')
                .then(response => response.json())
                .then(data => {
                    const memoryUsage = data.server.memoryUsage;
                    const fabricStatus = data.server.fabricAvailable ? 'Operational' : 'Offline';
                    showNotification(`System Health: Memory ${memoryUsage.heapUsed}/${memoryUsage.heapTotal}. Fabric: ${fabricStatus}`, 'info');
                })
                .catch(error => {
                    showNotification('Unable to monitor system health', 'error');
                });
        }

        function cleanReef() {
            if (confirm('Clean old files from Fabric Studio?')) {
                fetch('/api/management/cleanup-old', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        showNotification(`File cleanup complete: ${data.message}`, 'success');
                    })
                    .catch(error => {
                        showNotification('File cleanup failed', 'error');
                    });
            }
        }

        function refreshEcosystem() {
            // This function could refresh the file system or clear caches
            fetch('/api/management/status')
                .then(response => response.json())
                .then(data => {
                    showNotification(`File System Refreshed - ${data.server.patternsLoaded} patterns loaded, ${data.processes.active} active processes`, 'success');
                })
                .catch(error => {
                    showNotification('Unable to refresh file system', 'error');
                });
        }

        function resetLaboratory() {
            if (confirm('Reset Fabric Studio? This will clear all data and stop all processes.')) {
                fetch('/api/management/clear-all-data', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        showNotification(`Studio reset complete: ${data.message}`, 'success');
                        resetReefState(); // Reset UI state
                    })
                    .catch(error => {
                        showNotification('Studio reset failed', 'error');
                    });
            }
        }

        function restartReef() {
            if (confirm('Restart the server? Active processes will be interrupted.')) {
                fetch('/api/management/restart', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        showNotification('Server restart initiated', 'warning');
                    })
                    .catch(error => {
                        showNotification('Restart failed', 'error');
                    });
            }
        }

        function shutdownLab() {
            if (confirm('Shutdown Fabric Studio? This will halt all operations.')) {
                fetch('/api/management/shutdown', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        showNotification('Studio shutdown initiated', 'warning');
                    })
                    .catch(error => {
                        showNotification('Shutdown failed', 'error');
                    });
            }
        }

        // API Key Management functions
        function configureApiKeys() {
            apiKeyModal.classList.add('visible');
            loadApiKeys(); // Load current keys when opening
        }

        function closeApiKeyModal() {
            apiKeyModal.classList.remove('visible');
        }

        function saveApiKeys() {
            const apiKeys = {
                anthropic: document.getElementById('anthropic-key').value,
                openai: document.getElementById('openai-key').value,
                google: document.getElementById('google-key').value
            };

            fetch('/api/management/config/api-keys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(apiKeys)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('API keys saved successfully', 'success');
                } else {
                    showNotification('Failed to save API keys: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error saving API keys: ' + error.message, 'error');
            });
        }

        function loadApiKeys() {
            fetch('/api/management/config/api-keys')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show masked versions of keys
                    document.getElementById('anthropic-key').placeholder = data.keys.anthropic ? '••••••••••••••••' : 'sk-ant-api03-...';
                    document.getElementById('openai-key').placeholder = data.keys.openai ? '••••••••••••••••' : 'sk-proj-...';
                    document.getElementById('google-key').placeholder = data.keys.google ? '••••••••••••••••' : 'AIzaSy...';
                    
                    // Load fallback model configuration
                    if (data.fallbackModels) {
                        document.getElementById('fallback-models').value = data.fallbackModels.join('\n');
                    }
                } else {
                    showNotification('Failed to load API keys: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error loading API keys: ' + error.message, 'error');
            });
        }

        function clearApiKeys() {
            if (confirm('Clear all API keys? This will remove all stored credentials.')) {
                fetch('/api/management/config/api-keys', {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('API keys cleared successfully', 'success');
                        // Clear the form
                        document.getElementById('anthropic-key').value = '';
                        document.getElementById('openai-key').value = '';
                        document.getElementById('google-key').value = '';
                        loadApiKeys(); // Refresh placeholders
                    } else {
                        showNotification('Failed to clear API keys: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('Error clearing API keys: ' + error.message, 'error');
                });
            }
        }

        function testApiConnections() {
            fetch('/api/management/config/test-apis', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const results = data.results;
                    const workingApis = Object.keys(results).filter(key => results[key].working).length;
                    const totalApis = Object.keys(results).length;
                    
                    showNotification(`API Test Results: ${workingApis}/${totalApis} providers working`, 
                        workingApis > 0 ? 'success' : 'error');
                } else {
                    showNotification('Failed to test API connections: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error testing API connections: ' + error.message, 'error');
            });
        }

        function viewCurrentKeys() {
            fetch('/api/management/config/api-keys')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const keys = data.keys;
                    const configured = Object.keys(keys).filter(key => keys[key]).length;
                    const total = Object.keys(keys).length;
                    
                    showNotification(`API Configuration: ${configured}/${total} keys configured`, 'info');
                } else {
                    showNotification('Failed to load API configuration: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error loading API configuration: ' + error.message, 'error');
            });
        }

        function saveFallbackConfig() {
            const fallbackModels = document.getElementById('fallback-models').value
                .split('\n')
                .map(model => model.trim())
                .filter(model => model.length > 0);

            fetch('/api/management/config/fallback-models', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ fallbackModels })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Fallback model configuration saved successfully', 'success');
                } else {
                    showNotification('Failed to save fallback configuration: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error saving fallback configuration: ' + error.message, 'error');
            });
        }

        function resetToDefaults() {
            const defaultModels = [
                'claude-3-5-sonnet-20241022',
                'gpt-4o',
                'OpenAI o3',
                'gpt-4o-mini',
                'claude-3-5-haiku-20241022',
                'gpt-4-turbo'
            ];
            
            document.getElementById('fallback-models').value = defaultModels.join('\n');
            showNotification('Fallback models reset to defaults', 'info');
        }

        // Utility functions
        // isValidYouTubeUrl removed - YouTube URL not supported in cloud deployment

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--reef-bg-elevated);
                backdrop-filter: var(--reef-blur-medium);
                border: 2px solid var(--reef-border-strong);
                border-radius: var(--border-radius-coral);
                color: var(--text-reef-primary);
                padding: 16px 24px;
                max-width: 350px;
                z-index: 3000;
                box-shadow: var(--reef-shadow-medium);
                animation: slideInFromRight 0.3s ease-out;
            `;
            
            if (type === 'error') {
                notification.style.borderColor = 'rgba(255, 127, 80, 0.6)';
                notification.style.background = 'rgba(255, 127, 80, 0.1)';
            } else if (type === 'success') {
                notification.style.borderColor = 'rgba(32, 178, 170, 0.6)';
                notification.style.background = 'rgba(32, 178, 170, 0.1)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutToRight 0.3s ease-in forwards';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Add CSS for notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInFromRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutToRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Handle escape key for studio console
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeLaboratory();
            }
        });

        // Document Studio Functions
        
        // Analyze content for document opportunities
        async function analyzeDocumentOpportunities(processId) {
            try {
                console.log('Analyzing document opportunities for:', processId);
                
                const response = await fetch(`/api/document-opportunities/${processId}`, {
                    method: 'POST'
                });

                const data = await response.json();
                
                if (data.success && data.opportunities.length > 0) {
                    documentOpportunityData = data;
                    showDocumentOpportunities(data);
                } else {
                    console.log('No document opportunities found or analysis failed:', data.error);
                }
                
            } catch (error) {
                console.error('Error analyzing document opportunities:', error);
            }
        }

        // Show document opportunities in the UI
        function showDocumentOpportunities(data) {
            // Show document studio section
            documentLaboratorySection.classList.add('visible');
            
            // Hide other sub-sections initially
            documentGenerationProgress.style.display = 'none';
            documentResults.style.display = 'none';
            
            // Show opportunities section
            documentOpportunities.style.display = 'block';
            
            // Clear existing content
            selectedDocuments = [];
            updateGenerateButton();
            
            // Populate document tiers
            populateDocumentTiers(data.opportunities);
            
            showNotification(`🧬 Document Studio discovered ${data.opportunities.length} professional document opportunities!`, 'info');
        }

        // Populate document tiers with opportunities
        function populateDocumentTiers(opportunities) {
            // Group opportunities by tier
            const tierGroups = {};
            opportunities.forEach(opp => {
                if (!tierGroups[opp.tier]) {
                    tierGroups[opp.tier] = [];
                }
                tierGroups[opp.tier].push(opp);
            });

            // Populate each tier
            Object.entries(tierGroups).forEach(([tier, docs]) => {
                const tierElement = document.querySelector(`[data-tier="${tier}"] .tier-documents`);
                if (tierElement) {
                    tierElement.innerHTML = docs.map(doc => createDocumentOptionHTML(doc)).join('');
                }
            });

            // Add click handlers to document options
            document.querySelectorAll('.document-option').forEach(option => {
                option.addEventListener('click', () => toggleDocumentSelection(option));
            });
        }

        // Create HTML for a document option
        function createDocumentOptionHTML(doc) {
            const priorityColor = doc.priority === 'high' ? 'var(--coral-primary)' : 
                                doc.priority === 'medium' ? 'var(--sea-green)' : 'var(--text-reef-tertiary)';
                                
            return `
                <div class="document-option" data-document-id="${doc.id}">
                    <div class="checkbox"></div>
                    <div class="document-title">${doc.title}</div>
                    <div class="document-details">${doc.purpose}</div>
                    <div class="document-meta">
                        <span style="color: ${priorityColor}">●</span>
                        <span>${doc.priority.toUpperCase()} PRIORITY</span>
                        <span>•</span>
                        <span>${doc.estimatedLength}</span>
                        <span>•</span>
                        <span>${doc.complexity} complexity</span>
                    </div>
                </div>
            `;
        }

        // Toggle document selection
        function toggleDocumentSelection(optionElement) {
            const documentId = optionElement.dataset.documentId;
            const isSelected = optionElement.classList.contains('selected');
            
            if (isSelected) {
                optionElement.classList.remove('selected');
                selectedDocuments = selectedDocuments.filter(id => id !== documentId);
            } else {
                optionElement.classList.add('selected');
                selectedDocuments.push(documentId);
            }
            
            updateGenerateButton();
        }

        // Select all recommended documents
        function selectAllRecommendedDocuments() {
            const highPriorityOptions = document.querySelectorAll('.document-option');
            selectedDocuments = [];
            
            highPriorityOptions.forEach(option => {
                option.classList.add('selected');
                selectedDocuments.push(option.dataset.documentId);
            });
            
            updateGenerateButton();
            showNotification('All recommended documents selected for generation', 'info');
        }

        // Update generate button state
        function updateGenerateButton() {
            generateDocumentsBtn.disabled = selectedDocuments.length === 0;
            generateDocumentsBtn.textContent = selectedDocuments.length > 0 
                ? `Generate ${selectedDocuments.length} Document${selectedDocuments.length > 1 ? 's' : ''}` 
                : 'Generate Selected Documents';
        }

        // Generate selected documents
        async function generateSelectedDocuments() {
            if (selectedDocuments.length === 0 || !currentProcessId || !documentOpportunityData) {
                return;
            }

            try {
                // Get selected document specifications
                const selectedSpecs = documentOpportunityData.opportunities.filter(
                    opp => selectedDocuments.includes(opp.id)
                );

                const response = await fetch(`/api/generate-documents/${currentProcessId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        selectedDocuments: selectedSpecs
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // Document generation started - progress will be handled via WebSocket
                    isGeneratingDocuments = true;
                } else {
                    showNotification(`Document generation failed: ${data.error}`, 'error');
                }
                
            } catch (error) {
                console.error('Error starting document generation:', error);
                showNotification('Failed to start document generation', 'error');
            }
        }

        // Start document generation (WebSocket handler)
        function startDocumentGeneration(data) {
            // Hide opportunities, show progress
            documentOpportunities.style.display = 'none';
            documentGenerationProgress.style.display = 'block';
            
            // Update progress UI
            document.getElementById('total-documents').textContent = data.documentCount;
            document.getElementById('documents-generated').textContent = '0';
            document.getElementById('current-document-title').textContent = 'Initializing document generation...';
            document.getElementById('generation-progress-fill').style.width = '0%';
            
            showNotification(`🧬 Document Studio activated! Generating ${data.documentCount} professional documents...`, 'info');
        }

        // Update document generation progress (WebSocket handler)
        function updateDocumentGenerationProgress(data) {
            if (data.status === 'generating') {
                document.getElementById('current-document-title').textContent = `Generating: ${data.title}`;
            } else if (data.status === 'completed') {
                const generated = parseInt(document.getElementById('documents-generated').textContent) + 1;
                const total = parseInt(document.getElementById('total-documents').textContent);
                
                document.getElementById('documents-generated').textContent = generated;
                document.getElementById('generation-progress-fill').style.width = `${(generated / total) * 100}%`;
                
                if (generated < total) {
                    document.getElementById('current-document-title').textContent = `Completed: ${data.title}`;
                }
            } else if (data.status === 'failed') {
                document.getElementById('current-document-title').textContent = `Failed: ${data.title} - ${data.error}`;
            }
        }

        // Complete document generation (WebSocket handler)
        function completeDocumentGeneration(data) {
            isGeneratingDocuments = false;
            
            // Hide progress, show results
            documentGenerationProgress.style.display = 'none';
            documentResults.style.display = 'block';
            
            // Populate generated documents list
            const documentsList = document.getElementById('generated-documents-list');
            documentsList.innerHTML = data.documentsGenerated.map(doc => createGeneratedDocumentHTML(doc)).join('');
            
            // Update enhanced download link
            enhancedDownloadBtn.href = `/api/download/${currentProcessId}`;
            
            showNotification(`🧬 Document Studio complete! Generated ${data.documentsGenerated.length} professional documents.`, 'success');
        }

        // Create HTML for a generated document
        function createGeneratedDocumentHTML(doc) {
            const tierColors = {
                technical: '#2563eb',
                strategic: '#dc2626',
                educational: '#16a34a',
                operational: '#ca8a04'
            };
            
            const tierName = doc.id.split('-')[0];
            const tierColor = tierColors[tierName] || '#6b7280';
            
            return `
                <div class="generated-document-card">
                    <div class="document-title">${doc.title}</div>
                    <div class="document-meta">
                        <span class="document-tier-badge" style="background-color: ${tierColor}">
                            ${tierName.toUpperCase()}
                        </span>
                        <span>${doc.wordCount} words</span>
                    </div>
                </div>
            `;
        }

        // Document generation error handler
        function documentGenerationError(error) {
            isGeneratingDocuments = false;
            
            // Show error state
            document.getElementById('current-document-title').textContent = 'Document generation failed';
            showNotification(`Document generation failed: ${error}`, 'error');
            
            // Reset UI state
            documentGenerationProgress.style.display = 'none';
            documentOpportunities.style.display = 'block';
        }

        // Download enhanced results (with documents)
        function harvestEnhancedResults() {
            if (currentProcessId) {
                window.location.href = `/api/download/${currentProcessId}`;
                showNotification('Downloading enhanced results with professional documents...', 'info');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            initializeUniversalInterface();
            initializeWebSocket();
        });
    </script>
    
    <!-- Management Panel Toggle -->
    <div id="management-toggle" class="management-toggle">
        ⚙️
    </div>

    <!-- Management Modal -->
    <div id="management-modal" class="management-modal" style="display: none;">
        <div class="management-content">
            <div class="management-header">
                <h3>🧪 System Management</h3>
                <button id="close-management" class="close-management">✕</button>
            </div>
            <div class="management-body">
                <p>System management panel - feature coming soon!</p>
            </div>
        </div>
    </div>

    <!-- Main application JavaScript -->
    <script src="app.js"></script>
</body>
</html>