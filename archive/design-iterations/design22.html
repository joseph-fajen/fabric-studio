<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Fabric Processor - Premium Material</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            /* Premium Material Colors */
            --primary: #1565C0;
            --primary-variant: #0D47A1;
            --secondary: #37474F;
            --secondary-variant: #263238;
            --surface: #FAFAFA;
            --surface-variant: #F5F5F5;
            --surface-elevated: #FFFFFF;
            --surface-glass: rgba(255, 255, 255, 0.85);
            --background: #F8F9FA;
            --on-primary: #FFFFFF;
            --on-secondary: #FFFFFF;
            --on-surface: #212121;
            --on-surface-variant: #424242;
            --outline: #E0E0E0;
            --outline-variant: #EEEEEE;
            
            /* Premium Accents */
            --metallic-silver: linear-gradient(135deg, #E8E8E8 0%, #C0C0C0 50%, #E8E8E8 100%);
            --metallic-gold: linear-gradient(135deg, #F4E4BC 0%, #D4AF37 50%, #F4E4BC 100%);
            --glass-surface: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.6) 100%);
            
            /* Shadows & Elevations */
            --elevation-1: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
            --elevation-2: 0 4px 8px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.06);
            --elevation-3: 0 8px 16px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.08);
            --elevation-4: 0 16px 32px rgba(0,0,0,0.12), 0 8px 16px rgba(0,0,0,0.1);
            --elevation-premium: 0 24px 48px rgba(0,0,0,0.15), 0 12px 24px rgba(0,0,0,0.12);
            
            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            /* Animations */
            --transition-standard: cubic-bezier(0.4, 0.0, 0.2, 1);
            --transition-decelerate: cubic-bezier(0.0, 0.0, 0.2, 1);
            --transition-accelerate: cubic-bezier(0.4, 0.0, 1, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: var(--background);
            color: var(--on-surface);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Premium Material Components */
        .material-card {
            background: var(--surface-elevated);
            border-radius: 12px;
            box-shadow: var(--elevation-2);
            backdrop-filter: blur(20px);
            border: 1px solid var(--outline-variant);
            transition: all 0.3s var(--transition-standard);
            position: relative;
            overflow: hidden;
        }

        .material-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--metallic-silver);
            opacity: 0.5;
        }

        .material-card:hover {
            box-shadow: var(--elevation-3);
            transform: translateY(-2px);
        }

        .material-card-premium {
            background: var(--glass-surface);
            backdrop-filter: blur(40px);
            box-shadow: var(--elevation-premium);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .material-card-premium::before {
            background: var(--metallic-gold);
        }

        /* Header */
        .header {
            background: var(--surface-elevated);
            box-shadow: var(--elevation-2);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--outline-variant);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: var(--font-family);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s var(--transition-standard);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-variant) 100%);
            color: var(--on-primary);
            box-shadow: var(--elevation-1);
        }

        .btn-primary:hover {
            box-shadow: var(--elevation-2);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--surface-elevated);
            color: var(--on-surface);
            border: 1px solid var(--outline);
            box-shadow: var(--elevation-1);
        }

        .btn-secondary:hover {
            background: var(--surface-variant);
            box-shadow: var(--elevation-2);
        }

        .btn-outlined {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outlined:hover {
            background: rgba(21, 101, 192, 0.08);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 3rem;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .input-field {
            width: 100%;
            padding: 16px 24px;
            border: 2px solid var(--outline);
            border-radius: 12px;
            font-family: var(--font-family);
            font-size: 1rem;
            background: var(--surface-elevated);
            color: var(--on-surface);
            transition: all 0.3s var(--transition-standard);
            box-shadow: var(--elevation-1);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: var(--elevation-2), 0 0 0 4px rgba(21, 101, 192, 0.1);
        }

        .input-field::placeholder {
            color: var(--on-surface-variant);
        }

        /* Processing Status */
        .status-container {
            margin-bottom: 2rem;
            display: none;
        }

        .status-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--outline-variant);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-variant));
            width: 0%;
            transition: width 0.3s var(--transition-standard);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Fabric Patterns Grid */
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .pattern-card {
            background: var(--surface-elevated);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--elevation-2);
            border: 1px solid var(--outline-variant);
            transition: all 0.3s var(--transition-standard);
            position: relative;
            overflow: hidden;
        }

        .pattern-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--metallic-silver);
            opacity: 0.7;
        }

        .pattern-card:hover {
            box-shadow: var(--elevation-3);
            transform: translateY(-2px);
        }

        .pattern-card.processing {
            background: linear-gradient(135deg, rgba(21, 101, 192, 0.05) 0%, rgba(13, 71, 161, 0.02) 100%);
            border-color: var(--primary);
        }

        .pattern-card.processing::before {
            background: linear-gradient(90deg, var(--primary), var(--primary-variant));
            animation: pulse 2s infinite;
        }

        .pattern-card.completed {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(56, 142, 60, 0.02) 100%);
            border-color: #4CAF50;
        }

        .pattern-card.completed::before {
            background: linear-gradient(90deg, #4CAF50, #388E3C);
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .pattern-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .pattern-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--on-surface);
        }

        .pattern-phase {
            background: var(--secondary);
            color: var(--on-secondary);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .pattern-description {
            color: var(--on-surface-variant);
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .pattern-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .status-pending {
            background: var(--outline);
            color: var(--on-surface-variant);
        }

        .status-processing {
            background: var(--primary);
            color: var(--on-primary);
            animation: spin 1s linear infinite;
        }

        .status-completed {
            background: #4CAF50;
            color: white;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--glass-surface);
            backdrop-filter: blur(40px);
            border-radius: 12px;
            box-shadow: var(--elevation-3);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--on-surface);
        }

        .download-actions {
            display: flex;
            gap: 1rem;
        }

        /* Phase Sections */
        .phase-section {
            margin-bottom: 3rem;
        }

        .phase-header {
            background: var(--secondary);
            color: var(--on-secondary);
            padding: 1rem 1.5rem;
            border-radius: 8px 8px 0 0;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .phase-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--metallic-gold);
        }

        .phase-content {
            background: var(--surface-elevated);
            border-radius: 0 0 8px 8px;
            box-shadow: var(--elevation-2);
            border: 1px solid var(--outline-variant);
            border-top: none;
        }

        /* Management Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--surface-elevated);
            border-radius: 16px;
            box-shadow: var(--elevation-premium);
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--outline-variant);
        }

        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--metallic-gold);
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--outline-variant);
            display: flex;
            align-items: center;
            justify-content: between;
            background: var(--glass-surface);
            backdrop-filter: blur(20px);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--on-surface);
            flex: 1;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--on-surface-variant);
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s var(--transition-standard);
        }

        .modal-close:hover {
            background: var(--surface-variant);
            color: var(--on-surface);
        }

        .modal-body {
            overflow-y: auto;
            max-height: calc(80vh - 140px);
        }

        .modal-tabs {
            display: flex;
            background: var(--surface-variant);
            border-bottom: 1px solid var(--outline-variant);
        }

        .modal-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            font-family: var(--font-family);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--on-surface-variant);
            cursor: pointer;
            transition: all 0.3s var(--transition-standard);
            position: relative;
        }

        .modal-tab.active {
            color: var(--primary);
            background: var(--surface-elevated);
        }

        .modal-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }

        .modal-tab:hover:not(.active) {
            background: rgba(21, 101, 192, 0.05);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface-elevated);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--elevation-1);
        }

        .data-table th {
            background: var(--surface-variant);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--on-surface);
            border-bottom: 1px solid var(--outline-variant);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--outline-variant);
            color: var(--on-surface-variant);
        }

        .data-table tbody tr:hover {
            background: var(--surface-variant);
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-running {
            background: rgba(21, 101, 192, 0.1);
            color: var(--primary);
        }

        .status-success {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.1);
            color: #F44336;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                padding: 1rem;
            }

            .patterns-grid {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .download-actions {
                justify-content: center;
            }

            .modal {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
            }

            .modal-tabs {
                flex-direction: column;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s var(--transition-decelerate);
        }

        .slide-in {
            animation: slideIn 0.3s var(--transition-decelerate);
        }

        /* Glass Effect Utilities */
        .glass-card {
            background: var(--glass-surface);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Premium Accent Elements */
        .accent-line {
            height: 2px;
            background: var(--metallic-gold);
            border-radius: 1px;
        }

        .premium-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--outline), transparent);
            margin: 2rem 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <span class="material-icons">smart_toy</span>
                </div>
                <span>YouTube Fabric Processor</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="openManagementModal()">
                    <span class="material-icons">settings</span>
                    Management
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Input Section -->
        <section class="input-section material-card-premium">
            <div style="padding: 2rem;">
                <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--on-surface);">
                    Transform YouTube Videos into Insights
                </h1>
                <p style="color: var(--on-surface-variant); font-size: 1.125rem; margin-bottom: 2rem;">
                    Process any YouTube video through 13 fabric patterns to extract summaries, insights, and actionable knowledge in under 70 seconds.
                </p>
                
                <div class="input-group">
                    <input 
                        type="url" 
                        id="youtubeUrl" 
                        class="input-field" 
                        placeholder="Enter YouTube URL (e.g., https://www.youtube.com/watch?v=...)"
                        autocomplete="off"
                    >
                </div>
                
                <button class="btn btn-primary" onclick="processVideo()" id="processBtn">
                    <span class="material-icons">play_arrow</span>
                    Process Video
                </button>
            </div>
        </section>

        <!-- Processing Status -->
        <section class="status-container material-card" id="statusContainer">
            <div style="padding: 1.5rem;">
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--on-surface);">
                    Processing Status
                </h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="statusText" style="color: var(--on-surface-variant); font-size: 0.875rem;">
                    Initializing...
                </p>
            </div>
        </section>

        <!-- Fabric Patterns Grid -->
        <section class="patterns-section">
            <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--on-surface);">
                Fabric Patterns Progress
            </h2>
            
            <!-- Phase 1: Foundation -->
            <div class="phase-section">
                <div class="phase-header">
                    <span class="material-icons" style="margin-right: 8px;">foundation</span>
                    Phase 1: Foundation Analysis
                </div>
                <div class="phase-content">
                    <div class="patterns-grid" style="padding: 1.5rem;">
                        <div class="pattern-card" data-pattern="extract_wisdom">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract Wisdom</div>
                                <div class="pattern-phase">Phase 1</div>
                            </div>
                            <div class="pattern-description">
                                Extracts key insights, lessons, and wisdom from the content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="summarize">
                            <div class="pattern-header">
                                <div class="pattern-title">Summarize</div>
                                <div class="pattern-phase">Phase 1</div>
                            </div>
                            <div class="pattern-description">
                                Creates a comprehensive summary of the main content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="extract_ideas">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract Ideas</div>
                                <div class="pattern-phase">Phase 1</div>
                            </div>
                            <div class="pattern-description">
                                Identifies and extracts the core ideas and concepts
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="create_5_sentence_summary">
                            <div class="pattern-header">
                                <div class="pattern-title">5-Sentence Summary</div>
                                <div class="pattern-phase">Phase 1</div>
                            </div>
                            <div class="pattern-description">
                                Distills content into exactly five key sentences
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 2: Analysis -->
            <div class="phase-section">
                <div class="phase-header">
                    <span class="material-icons" style="margin-right: 8px;">analytics</span>
                    Phase 2: Deep Analysis
                </div>
                <div class="phase-content">
                    <div class="patterns-grid" style="padding: 1.5rem;">
                        <div class="pattern-card" data-pattern="extract_questions">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract Questions</div>
                                <div class="pattern-phase">Phase 2</div>
                            </div>
                            <div class="pattern-description">
                                Generates thought-provoking questions from the content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="analyze_claims">
                            <div class="pattern-header">
                                <div class="pattern-title">Analyze Claims</div>
                                <div class="pattern-phase">Phase 2</div>
                            </div>
                            <div class="pattern-description">
                                Examines and evaluates claims made in the content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="find_logical_fallacies">
                            <div class="pattern-header">
                                <div class="pattern-title">Find Logical Fallacies</div>
                                <div class="pattern-phase">Phase 2</div>
                            </div>
                            <div class="pattern-description">
                                Identifies logical fallacies and reasoning errors
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Extraction -->
            <div class="phase-section">
                <div class="phase-header">
                    <span class="material-icons" style="margin-right: 8px;">library_books</span>
                    Phase 3: Knowledge Extraction
                </div>
                <div class="phase-content">
                    <div class="patterns-grid" style="padding: 1.5rem;">
                        <div class="pattern-card" data-pattern="extract_references">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract References</div>
                                <div class="pattern-phase">Phase 3</div>
                            </div>
                            <div class="pattern-description">
                                Pulls out references, citations, and sources mentioned
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="extract_predictions">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract Predictions</div>
                                <div class="pattern-phase">Phase 3</div>
                            </div>
                            <div class="pattern-description">
                                Identifies predictions and future-oriented statements
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="extract_recommendations">
                            <div class="pattern-header">
                                <div class="pattern-title">Extract Recommendations</div>
                                <div class="pattern-phase">Phase 3</div>
                            </div>
                            <div class="pattern-description">
                                Compiles actionable recommendations and advice
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 4: Synthesis -->
            <div class="phase-section">
                <div class="phase-header">
                    <span class="material-icons" style="margin-right: 8px;">merge_type</span>
                    Phase 4: Synthesis & Creation
                </div>
                <div class="phase-content">
                    <div class="patterns-grid" style="padding: 1.5rem;">
                        <div class="pattern-card" data-pattern="create_quiz">
                            <div class="pattern-header">
                                <div class="pattern-title">Create Quiz</div>
                                <div class="pattern-phase">Phase 4</div>
                            </div>
                            <div class="pattern-description">
                                Generates a quiz to test understanding of the content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="create_outline">
                            <div class="pattern-header">
                                <div class="pattern-title">Create Outline</div>
                                <div class="pattern-phase">Phase 4</div>
                            </div>
                            <div class="pattern-description">
                                Creates a structured outline of the content
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>

                        <div class="pattern-card" data-pattern="create_video_chapters">
                            <div class="pattern-header">
                                <div class="pattern-title">Create Video Chapters</div>
                                <div class="pattern-phase">Phase 4</div>
                            </div>
                            <div class="pattern-description">
                                Generates timestamped chapters for the video
                            </div>
                            <div class="pattern-status">
                                <div class="status-icon status-pending">
                                    <span class="material-icons" style="font-size: 12px;">schedule</span>
                                </div>
                                <span>Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section material-card" id="resultsSection">
            <div class="results-header">
                <div class="results-title">Processing Complete</div>
                <div class="download-actions">
                    <button class="btn btn-primary" onclick="downloadZip()" id="downloadBtn">
                        <span class="material-icons">download</span>
                        Download Results
                    </button>
                    <button class="btn btn-secondary" onclick="viewIndex()">
                        <span class="material-icons">description</span>
                        View Summary
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Management Modal -->
    <div class="modal-overlay" id="managementModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">System Management</h2>
                <button class="modal-close" onclick="closeManagementModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-tabs">
                <button class="modal-tab active" onclick="switchTab('status')">System Status</button>
                <button class="modal-tab" onclick="switchTab('history')">Processing History</button>
                <button class="modal-tab" onclick="switchTab('cleanup')">Cleanup</button>
                <button class="modal-tab" onclick="switchTab('settings')">Settings</button>
            </div>
            <div class="modal-body">
                <div class="tab-content active" id="statusTab">
                    <h3 style="margin-bottom: 1rem; color: var(--on-surface);">Server Status</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="glass-card" style="padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="serverUptime">0h 0m</div>
                            <div style="color: var(--on-surface-variant);">Uptime</div>
                        </div>
                        <div class="glass-card" style="padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="activeProcesses">0</div>
                            <div style="color: var(--on-surface-variant);">Active Processes</div>
                        </div>
                        <div class="glass-card" style="padding: 1rem; text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="totalProcessed">0</div>
                            <div style="color: var(--on-surface-variant);">Total Processed</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-secondary" onclick="refreshStatus()">
                            <span class="material-icons">refresh</span>
                            Refresh Status
                        </button>
                        <button class="btn btn-outlined" onclick="restartServer()">
                            <span class="material-icons">restart_alt</span>
                            Restart Server
                        </button>
                    </div>
                </div>

                <div class="tab-content" id="historyTab">
                    <h3 style="margin-bottom: 1rem; color: var(--on-surface);">Processing History</h3>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Video Title</th>
                                    <th>URL</th>
                                    <th>Status</th>
                                    <th>Duration</th>
                                    <th>Completed</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; color: var(--on-surface-variant);">
                                        No processing history available
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="tab-content" id="cleanupTab">
                    <h3 style="margin-bottom: 1rem; color: var(--on-surface);">Storage Cleanup</h3>
                    <p style="color: var(--on-surface-variant); margin-bottom: 2rem;">
                        Clean up old processing results to free disk space. This will remove output folders older than the specified number of days.
                    </p>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 2rem;">
                        <label for="cleanupDays" style="color: var(--on-surface);">Remove files older than:</label>
                        <select id="cleanupDays" style="padding: 8px 12px; border: 1px solid var(--outline); border-radius: 4px; background: var(--surface-elevated);">
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="30" selected>30 days</option>
                            <option value="60">60 days</option>
                        </select>
                        <button class="btn btn-secondary" onclick="performCleanup()">
                            <span class="material-icons">cleaning_services</span>
                            Clean Up
                        </button>
                    </div>
                    <div id="cleanupResults" style="padding: 1rem; background: var(--surface-variant); border-radius: 8px; display: none;">
                        <h4 style="margin-bottom: 0.5rem; color: var(--on-surface);">Cleanup Results</h4>
                        <p id="cleanupMessage" style="color: var(--on-surface-variant);"></p>
                    </div>
                </div>

                <div class="tab-content" id="settingsTab">
                    <h3 style="margin-bottom: 1rem; color: var(--on-surface);">System Settings</h3>
                    <div style="display: grid; gap: 2rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--on-surface); font-weight: 500;">
                                Maximum Concurrent Processes
                            </label>
                            <select id="maxConcurrent" style="width: 100%; padding: 12px; border: 1px solid var(--outline); border-radius: 8px; background: var(--surface-elevated);">
                                <option value="1">1 (Conservative)</option>
                                <option value="2">2 (Balanced)</option>
                                <option value="3" selected>3 (Recommended)</option>
                                <option value="4">4 (Aggressive)</option>
                                <option value="5">5 (Maximum)</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--on-surface); font-weight: 500;">
                                Fabric Model
                            </label>
                            <select id="fabricModel" style="width: 100%; padding: 12px; border: 1px solid var(--outline); border-radius: 8px; background: var(--surface-elevated);">
                                <option value="claude-3-5-sonnet-20241022" selected>Claude 3.5 Sonnet (Recommended)</option>
                                <option value="gpt-4o">GPT-4o</option>
                                <option value="gpt-4o-mini">GPT-4o Mini</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <span class="material-icons">save</span>
                                Save Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentProcessingId = null;
        let websocket = null;
        let processingResults = {};

        // Pattern definitions
        const fabricPatterns = {
            'extract_wisdom': { phase: 1, title: 'Extract Wisdom', description: 'Extracts key insights, lessons, and wisdom from the content' },
            'summarize': { phase: 1, title: 'Summarize', description: 'Creates a comprehensive summary of the main content' },
            'extract_ideas': { phase: 1, title: 'Extract Ideas', description: 'Identifies and extracts the core ideas and concepts' },
            'create_5_sentence_summary': { phase: 1, title: '5-Sentence Summary', description: 'Distills content into exactly five key sentences' },
            'extract_questions': { phase: 2, title: 'Extract Questions', description: 'Generates thought-provoking questions from the content' },
            'analyze_claims': { phase: 2, title: 'Analyze Claims', description: 'Examines and evaluates claims made in the content' },
            'find_logical_fallacies': { phase: 2, title: 'Find Logical Fallacies', description: 'Identifies logical fallacies and reasoning errors' },
            'extract_references': { phase: 3, title: 'Extract References', description: 'Pulls out references, citations, and sources mentioned' },
            'extract_predictions': { phase: 3, title: 'Extract Predictions', description: 'Identifies predictions and future-oriented statements' },
            'extract_recommendations': { phase: 3, title: 'Extract Recommendations', description: 'Compiles actionable recommendations and advice' },
            'create_quiz': { phase: 4, title: 'Create Quiz', description: 'Generates a quiz to test understanding of the content' },
            'create_outline': { phase: 4, title: 'Create Outline', description: 'Creates a structured outline of the content' },
            'create_video_chapters': { phase: 4, title: 'Create Video Chapters', description: 'Generates timestamped chapters for the video' }
        };

        // Initialize WebSocket connection
        function initWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = function() {
                console.log('WebSocket connected');
            };
            
            websocket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            websocket.onclose = function() {
                console.log('WebSocket disconnected');
                // Attempt to reconnect after 3 seconds
                setTimeout(initWebSocket, 3000);
            };
            
            websocket.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        }

        // Handle WebSocket messages
        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'progress':
                    updateProgress(data.progress, data.status);
                    break;
                case 'pattern_start':
                    updatePatternStatus(data.pattern, 'processing');
                    break;
                case 'pattern_complete':
                    updatePatternStatus(data.pattern, 'completed');
                    break;
                case 'complete':
                    handleProcessingComplete(data);
                    break;
                case 'error':
                    handleProcessingError(data.error);
                    break;
            }
        }

        // Process video
        async function processVideo() {
            const url = document.getElementById('youtubeUrl').value.trim();
            if (!url) {
                alert('Please enter a YouTube URL');
                return;
            }

            // Validate YouTube URL
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
            if (!youtubeRegex.test(url)) {
                alert('Please enter a valid YouTube URL');
                return;
            }

            // Reset UI
            resetProcessingUI();
            
            // Show status container
            document.getElementById('statusContainer').classList.add('active');
            document.getElementById('processBtn').disabled = true;
            document.getElementById('processBtn').innerHTML = '<span class="material-icons">hourglass_empty</span>Processing...';

            try {
                const response = await fetch('/api/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                currentProcessingId = result.id;
                
                // Start polling for updates if WebSocket is not available
                if (websocket.readyState !== WebSocket.OPEN) {
                    pollProcessingStatus();
                }

            } catch (error) {
                console.error('Error starting processing:', error);
                handleProcessingError(error.message);
            }
        }

        // Reset processing UI
        function resetProcessingUI() {
            // Reset progress
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('statusText').textContent = 'Initializing...';
            
            // Reset all pattern cards
            document.querySelectorAll('.pattern-card').forEach(card => {
                card.classList.remove('processing', 'completed');
                const statusIcon = card.querySelector('.status-icon');
                const statusText = card.querySelector('.pattern-status span:last-child');
                
                statusIcon.className = 'status-icon status-pending';
                statusIcon.innerHTML = '<span class="material-icons" style="font-size: 12px;">schedule</span>';
                statusText.textContent = 'Pending';
            });
            
            // Hide results
            document.getElementById('resultsSection').classList.remove('active');
        }

        // Update progress
        function updateProgress(progress, status) {
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('statusText').textContent = status;
        }

        // Update pattern status
        function updatePatternStatus(pattern, status) {
            const card = document.querySelector(`[data-pattern="${pattern}"]`);
            if (!card) return;

            const statusIcon = card.querySelector('.status-icon');
            const statusText = card.querySelector('.pattern-status span:last-child');
            
            card.classList.remove('processing', 'completed');
            
            switch(status) {
                case 'processing':
                    card.classList.add('processing');
                    statusIcon.className = 'status-icon status-processing';
                    statusIcon.innerHTML = '<span class="material-icons" style="font-size: 12px;">refresh</span>';
                    statusText.textContent = 'Processing';
                    break;
                case 'completed':
                    card.classList.add('completed');
                    statusIcon.className = 'status-icon status-completed';
                    statusIcon.innerHTML = '<span class="material-icons" style="font-size: 12px;">check</span>';
                    statusText.textContent = 'Completed';
                    break;
            }
        }

        // Handle processing complete
        function handleProcessingComplete(data) {
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('statusText').textContent = 'Processing completed successfully!';
            
            // Enable download button
            document.getElementById('downloadBtn').onclick = () => downloadZip(data.id);
            
            // Show results section
            document.getElementById('resultsSection').classList.add('active');
            
            // Reset process button
            document.getElementById('processBtn').disabled = false;
            document.getElementById('processBtn').innerHTML = '<span class="material-icons">play_arrow</span>Process Video';
            
            processingResults = data;
        }

        // Handle processing error
        function handleProcessingError(error) {
            document.getElementById('statusText').textContent = `Error: ${error}`;
            document.getElementById('statusText').style.color = '#F44336';
            
            // Reset process button
            document.getElementById('processBtn').disabled = false;
            document.getElementById('processBtn').innerHTML = '<span class="material-icons">play_arrow</span>Process Video';
            
            alert(`Processing failed: ${error}`);
        }

        // Poll processing status (fallback)
        async function pollProcessingStatus() {
            if (!currentProcessingId) return;
            
            try {
                const response = await fetch(`/api/process/${currentProcessingId}`);
                const data = await response.json();
                
                if (data.status === 'completed') {
                    handleProcessingComplete(data);
                } else if (data.status === 'error') {
                    handleProcessingError(data.error);
                } else {
                    // Continue polling
                    setTimeout(pollProcessingStatus, 2000);
                }
            } catch (error) {
                console.error('Error polling status:', error);
                setTimeout(pollProcessingStatus, 5000);
            }
        }

        // Download ZIP
        function downloadZip(id = currentProcessingId) {
            if (!id) {
                alert('No processing results available for download');
                return;
            }
            
            window.open(`/api/download/${id}`, '_blank');
        }

        // View index
        function viewIndex() {
            if (!processingResults.id) {
                alert('No processing results available');
                return;
            }
            
            window.open(`/outputs/${processingResults.id}/index.md`, '_blank');
        }

        // Management Modal Functions
        function openManagementModal() {
            document.getElementById('managementModal').classList.add('active');
            loadSystemStatus();
        }

        function closeManagementModal() {
            document.getElementById('managementModal').classList.remove('active');
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load tab-specific data
            switch(tabName) {
                case 'status':
                    loadSystemStatus();
                    break;
                case 'history':
                    loadProcessingHistory();
                    break;
            }
        }

        // Load system status
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/management/status');
                const data = await response.json();
                
                document.getElementById('serverUptime').textContent = formatUptime(data.uptime);
                document.getElementById('activeProcesses').textContent = data.activeProcesses || 0;
                document.getElementById('totalProcessed').textContent = data.totalProcessed || 0;
            } catch (error) {
                console.error('Error loading system status:', error);
            }
        }

        // Format uptime
        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${hours}h ${minutes}m`;
        }

        // Load processing history
        async function loadProcessingHistory() {
            try {
                const response = await fetch('/api/management/history');
                const data = await response.json();
                
                const tbody = document.getElementById('historyTableBody');
                tbody.innerHTML = '';
                
                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--on-surface-variant);">No processing history available</td></tr>';
                    return;
                }
                
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.title || 'Unknown'}</td>
                        <td><a href="${item.url}" target="_blank" style="color: var(--primary);">${item.url.substring(0, 50)}...</a></td>
                        <td><span class="status-badge status-${item.status}">${item.status}</span></td>
                        <td>${item.duration || 'N/A'}</td>
                        <td>${item.completed || 'N/A'}</td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 0.75rem;" onclick="downloadZip('${item.id}')">
                                <span class="material-icons" style="font-size: 14px;">download</span>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading processing history:', error);
            }
        }

        // Refresh status
        function refreshStatus() {
            loadSystemStatus();
        }

        // Restart server
        async function restartServer() {
            if (!confirm('Are you sure you want to restart the server? This will interrupt any running processes.')) {
                return;
            }
            
            try {
                await fetch('/api/management/restart', { method: 'POST' });
                alert('Server restart initiated. The page will reload in a few seconds.');
                setTimeout(() => window.location.reload(), 3000);
            } catch (error) {
                console.error('Error restarting server:', error);
                alert('Error restarting server');
            }
        }

        // Perform cleanup
        async function performCleanup() {
            const days = document.getElementById('cleanupDays').value;
            
            if (!confirm(`Are you sure you want to delete all processing results older than ${days} days?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/management/cleanup-old', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ days: parseInt(days) })
                });
                
                const data = await response.json();
                
                document.getElementById('cleanupResults').style.display = 'block';
                document.getElementById('cleanupMessage').textContent = data.message;
            } catch (error) {
                console.error('Error performing cleanup:', error);
                alert('Error performing cleanup');
            }
        }

        // Save settings
        function saveSettings() {
            const maxConcurrent = document.getElementById('maxConcurrent').value;
            const fabricModel = document.getElementById('fabricModel').value;
            
            // In a real implementation, these would be saved to the server
            localStorage.setItem('maxConcurrent', maxConcurrent);
            localStorage.setItem('fabricModel', fabricModel);
            
            alert('Settings saved successfully!');
        }

        // Load settings
        function loadSettings() {
            const maxConcurrent = localStorage.getItem('maxConcurrent') || '3';
            const fabricModel = localStorage.getItem('fabricModel') || 'claude-3-5-sonnet-20241022';
            
            document.getElementById('maxConcurrent').value = maxConcurrent;
            document.getElementById('fabricModel').value = fabricModel;
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initWebSocket();
            loadSettings();
            
            // Add enter key handler for URL input
            document.getElementById('youtubeUrl').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processVideo();
                }
            });
            
            // Close modal when clicking overlay
            document.getElementById('managementModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeManagementModal();
                }
            });
        });
    </script>
</body>
</html>